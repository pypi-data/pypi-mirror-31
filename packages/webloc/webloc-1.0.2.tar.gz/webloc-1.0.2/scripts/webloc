#!/usr/bin/env bash
{ set +x; } 2>/dev/null

usage="usage: ${BASH_SOURCE[0]##*/} path [url]"

[[ $1 == "--help" ]] && {
	echo "$usage"
	[[ $1 == "--help" ]]; exit # exit 0 if --help
}

[[ $OSTYPE != *darwin* ]] && echo "SKIP: OS X only" && exit 0

[[ $# == 1 ]] && { /usr/libexec/plistbuddy -c "Print URL" "$1"; exit; }
[[ $# == 2 ]] && {
	[[ -z $2 ]] && echo "EMPTY url" && exit 1
	rm -f "$1"
	[[ $1 == */* ]] && ! [ -e "${1%/*}" ] && {
		( set -x; mkdir -p "${1%/*}" ) || exit
	}
	[[ $1 != *.webloc ]] && set -- "$1".webloc "$2"
	/usr/libexec/plistbuddy -c "Add URL string '$2'" "$1" &> /dev/null
	exit
}

echo "$usage"; exit 1
