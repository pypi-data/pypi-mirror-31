#!/usr/bin/env bash
{ set +x; } 2>/dev/null

usage="usage: ${BASH_SOURCE[0]##*/} url ..."

[[ -z "$1" ]] || [[ $1 == "--help" ]] && {
	echo "$usage"
	[[ $1 == "--help" ]]; exit # exit 0 if --help
}

IFS=
while [[ $# != 0 ]]; do
    url="$1"; shift
    curl -s -X PURGE -o /dev/null --max-time 3 "$url"
    images="$(curl -s "$url" | grep -o '<img[ ]*src="[^"]*"' | grep -o '"[^"]*"' | tr -d '"' | sort -u)"
    [[ -z "$images" ]] && continue

    (
        IFS=$'\n';set $images
        curl -s -X PURGE -o /dev/null --max-time 3 "$@" 1> /dev/null
    )
done;:
