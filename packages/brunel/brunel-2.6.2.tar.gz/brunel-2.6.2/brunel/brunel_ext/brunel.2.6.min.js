var BrunelD3=function(){function h(a){try{var b=a.getBBox()}catch(c){return null}L&&"use"===a.tagName&&(b.x+=+a.getAttribute("x"),b.y+=+a.getAttribute("y"));return b.width||b.height?b:null}function A(a,b){var c=b.getCTM();c&&a&&(a={x:c.a*a.x+c.c*a.y+c.e,y:c.b*a.x+c.d*a.y+c.f,width:c.a*a.width+c.c*a.height,height:c.b*a.width+c.d*a.height});return a}function g(a,b,c){if(!a)return null;b=a.width*(b||1/3);c=a.height*(c||1/3);return{x:a.x+(a.width-b)/2,y:a.y+(a.height-c)/2,width:b,height:c}}function a(a,
b,c){var e=a.__data__,f=b.pad||2,j;j=b.method;var k=b.location;if(b.where){j=h(a);if(!j)return null;e=b.where(j,c,e);e={x:e.x,y:e.y,box:j}}else if("wedge"==j)j=b.path,b=j.centroid(e),k=Math.atan2(b[1],b[0]),f=1.3333*Math.sqrt(b[0]*b[0]+b[1]*b[1]),b=Math.cos(k)*f,k=Math.sin(k)*f,f=j.outerRadius()(e),c=j.innerRadius()(e),e=Math.abs(j.endAngle()(e)-j.startAngle()(e))*(f*f-c*c)/2,e=Math.sqrt(0.75*e)/2,e={x:b,y:k,box:{x:b-e,y:k-e,width:2*e,height:2*e}};else if("poly"==j)b=a.getTotalLength(),e=a.getPointAtLength(b/
4),b=a.getPointAtLength(3*b/4),e={x:(e.x+b.x)/2,y:(e.y+b.y)/2,box:g(h(a))};else if("area"==j)if(k=3.5*c.length,e=h(a)){var l=a.getTotalLength(),f=Math.max(6,e.width/40),m=Math.max(l/f,200);c=Math.round(e.width/f);var w,u,r;b=[];j=[];for(w=0;w<m;w++){u=a.getPointAtLength(l*(w+0.5)/m);r=Math.round((u.x-e.x)/f);if(!b[r]||b[r]<u.y)b[r]=u.y;if(!j[r]||j[r]>u.y)j[r]=u.y}m=c/2;l=0;for(w in j)u=b[w]-j[w],j[w+1]&&j[w-1]&&(u=(2*u+(b[w+1]-j[w+1]+b[w-1]-j[w-1])/2)/3),r=Math.min(w,c-w)*f,r<k?u*=0.01:r<3*k&&(u*=
0.8),u>l&&(m=w,l=u);k=e.x+m*f;b=(b[m]+j[m])/2;l<e.height/5&&20>l&&(l=20);e={x:k,y:b,box:{x:k-e.width/3,y:b-l/2,width:e.width/3,height:l}}}else e=null;else if("path"==j)b.path.centroid?(e=b.path.centroid(e),e={x:e[0],y:e[1],box:g(h(a))}):(e=0.5,"start"==b.align?e=0:"end"==b.align&&(e=1),e=a.getPointAtLength(a.getTotalLength()*e),e={x:e.x,y:e.y,box:g(h(a),1,1/3)});else{j=h(a);if(!j)return null;j=A(j,a);a="start"==b.align?f:-f;e=b.inside?-f:f;return{x:j.x+("left"==k[0]?a:"right"==k[0]?j.width+a:j.width/
2),y:j.y+("top"==k[1]?-e:"bottom"==k[1]?j.height+e:j.height/2),box:j}}if(!e||!e.box)return null;(b=e)?(e=A({x:b.x,y:b.y,width:1,height:1},a),a=A(b.box,a),a=e&&a?{x:e.x,y:e.y,box:a}:null):a=null;return a}function b(a,b,c){a=(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y);return 0===a?0:0<a?-1:1}function c(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)}function e(a,b,c){for(var e,f=-1,g=b.length-3;1<g-f;)e=Math.floor((g+f)/2),a.textContent=0>e?"":
0==e?b.substring(0,1):b.substring(0,e)+"…",a.getComputedTextLength()<=c?f=e:g=e;for(;0<f&&-1<" ,.;-".indexOf(b.charAt(f-1));)f--;a.textContent=0>f?"":0==f?b.substring(0,1):b.substring(0,f)+"…";return 0<=f}function f(a,b){b&&b.__transition__?setTimeout(function(){f(a,b)},100):a.call()}function j(a,b){var c;a.eachAfter(function(a){var e=a.children;if(e){b&&(a.value=0);for(c=0;c<e.length;c++)a.height=Math.min(a.height,e[c].height+1),b&&(a.value+=e[c].value)}else a.height=0})}function k(a,b){if(!b||!b.D)return!1;
null==b.x&&(b.x=a.x,b.y=a.y);var c,e,f=b.D,g=a.x-b.x;c=a.y-b.y;var j=f*Math.round(g/f),g=g+a.width,h=f*Math.round(c/f),k=c+a.height;for(c=j;c<=g;c+=f)for(e=h;e<=k;e+=f)if(b[1E4*c+e])return!0;for(c=j;c<=g;c+=f)for(e=h;e<=k;e+=f)b[1E4*c+e]=!0;return!1}function l(b,c,f,g,j){var l=b.__data__;l.data&&void 0!=l.data.row&&(l=l.data);var m=f.content(l);if(m&&b.parentNode){f.align||(f.align="middle");var D=b.__labels__;D||(b.__labels__=D={});var n=D[f.index];n||(n=c.append("text"),D[f.index]=n,n.__labeling__=
f);f.cssClass?n.attr("class",f.cssClass(l)):n.classed("label",!0);n.classed("selected",b.classList&&b.classList.contains("selected"));c=n.node();l=getComputedStyle(c).verticalAlign;if((b=a(b,f,m))&&b.box)if(l.endsWith("px")&&(b.y+=Number(l.substring(0,l.length-2))),n.style("text-anchor",f.align).attr("dy",(f.dy||"0.25")+"em"),f.fit&&!f.where){for(f=f.dy;c.firstChild;)c.removeChild(c.firstChild);D=m.split(/\s+/);g=[];for(var w,u,n=b.box.width-2,m=0;m<D.length;m++){j=D[m];g.push(j);if(u)u.textContent=
g.join(" ");else{w=b;u=c;var l=j,r=document.createElementNS("http://www.w3.org/2000/svg","tspan");r.setAttribute("class","label");r.setAttribute("x",w.x);r.setAttribute("y",w.y);r.textContent=l;u.appendChild(r);u=r;w=u.getBoundingClientRect().height}if(c.childNodes.length*w>b.box.height){c.removeChild(u);break}if(u.getComputedTextLength()>n){g.pop();if(g.length)u.textContent=g.join(" "),m--;else if(!e(u,j,n-4)){c.removeChild(u);break}u=null;g=[]}}if(c=c.childNodes){b=0.5+f;for(m=0;m<c.length;m++)c[m].setAttribute("dy",
1.1*(m-c.length/2)+b+"em")}}else{n.attr("x",b.x).attr("y",b.y).text(m);if((w=h(c))&&!f.fit)u=j.inner_left,r=u+j.inner_rawWidth,j=w.x,l=j+w.width,j<u+2&&l>u-2?(u+=2,"end"==f.align?u+=l-j:"middle"==f.align&&(u+=(l-j)/2),c.setAttribute("x",u)):l>r-2&&j<r+2&&(u=r-2,"start"==f.align?u-=l-j:"middle"==f.align&&(u-=(l-j)/2),c.setAttribute("x",u));if(f.fit){if(b=w.height>b.box.height||w.width>b.box.width&&!e(c,m,b.box.width))c.parentNode.removeChild(c),D[f.index]=null}else n.classed("overlap",k(w,g))}}}function m(a,
b){return"M"+a.x1+","+a.y1+(b?"A"+2*a.d+","+2*a.d+" 0 0,1 ":"L")+a.x2+","+a.y2}function n(a,b,c,e,f,g){var j=a-e,h=b-f,k=Math.sqrt(j*j+h*h);c=c.radius||(c.data?c.data.radius:5)||5;g=g.radius||(g.data?g.data.radius:5)||5;return k<c+g+1?null:{x1:a-j*c/k,y1:b-h*c/k,x2:e+j*g/k,y2:f+h*g/k,d:k}}function q(a,b,c,e){result={distance:1E99};a.forEach(function(a){v=0;"y"!=e&&(v+=(a.x-b)*(a.x-b));"x"!=e&&(v+=(a.y-c)*(a.y-c));v<result.distance&&(result.distance=v,result.d=a.d,result.x=a.x,result.y=a.y)});return result}
function s(a,b,c){var e,f,g,j,k,l,m,u,r={distance:9E99};a.each(function(a){u=this;e=e||d3.mouse(this);l=e[0];m=e[1];if(a.points)a.points.forEach(function(c){f=0;"y"!=b&&(f+=(c.x-l)*(c.x-l));"x"!=b&&(f+=(c.y-m)*(c.y-m));f<r.distance&&(r.distance=f,r.item=a,r.target=u,r.x=c.x,r.y=c.y)});else if(k=h(this)){var c=l<k.x?-1:l>k.x+k.width?1:0,t=m<k.y?-1:m>k.y+k.height?1:0;0==c&&0==t?f=0:(g=0>c?k.x:0<c?k.x+k.width:l,j=0>t?k.y:0<t?k.y+k.height:m,f=0,"y"!=b&&(f+=(g-l)*(g-l)),"x"!=b&&(f+=(j-m)*(j-m)));f<r.distance&&
(r.distance=f,r.item=a,r.target=u,r.x=g,r.y=j)}});r.distance=Math.sqrt(r.distance);r.distance>c&&(r.item=null);return r}function y(a){return a&&(null!=a.row||y(a.data))}"undefined"===typeof topojson&&"function"===typeof require&&(topojson=require("topojson"));"undefined"===typeof d3&&"function"===typeof require&&(d3=require("d3"));var L=-1===window.navigator.userAgent.toLowerCase().indexOf("chrome"),x,I,R;return{makeData:function(a){var b=BrunelData.Dataset.makeTyped(a.names,a.options,a.rows);b.set("summarized",
a.summarized);return b},geometry:function(a,b,c,e,f,g,j,h,k){var l=a.getBoundingClientRect(),m=l.left,r=l.top,z=l.width,l=l.height,n=a.ownerSVGElement;n?(n=n.getBoundingClientRect(),m-=n.left,r-=n.top):r=m=0;z||(z=a.getAttribute("width"));l||(l=a.getAttribute("height"));a={chart_top:r+l*b,chart_bottom:r+l*e,chart_left:m+z*c,chart_right:m+z*f,outer_width:z,outer_height:l,inner_top:g,inner_bottom:h,inner_left:j,inner_right:k,transpose:function(){var a=this.inner_width;this.inner_width=this.inner_height;
this.inner_height=a},makeSquare:function(){var a=this.inner_width-this.inner_height;0<a?(this.inner_width-=a,this.inner_right-=a,this.chart_right-=a,this.inner_rawWidth-=a):(this.inner_height+=a,this.inner_bottom+=a,this.chart_bottom+=a,this.inner_rawHeight+=a)}};a.inner_width=z-(a.chart_left+a.inner_left)-(z-a.chart_right+a.inner_right);a.inner_height=l-(a.chart_top+a.inner_top)-(l-a.chart_bottom+a.inner_bottom);a.inner_rawWidth=a.inner_width;a.inner_rawHeight=a.inner_height;a.inner_radius=Math.min(a.inner_width,
a.inner_height)/2;a.default_point_size=Math.max(6,0.035*a.inner_radius);return a},addTooltip:function(b,c){function e(){b.on("mousemove",m);b.on("mouseout",u)}function f(a,c){b.on("mousemove",m);a.select("rect.overlay").on("mousemove.tooltip_snap",function(){var a=s(b,"xy",c);a.item?m.call(a.target,a.item):u()}).on("mouseout.tooltip_snap",function(){u()})}var g=b.node();if(g){var j=g.ownerSVGElement;if(j){var h=+j.attributes.width.value,k=+j.attributes.height.value,l=j.createSVGPoint(),m=function(b){function e(b,
h){var k=a(b,c,"",h),t=j.getScreenCTM();l.x=k.x+t.e+f;l.y=k.y+t.f+g;return l}if(b){b.data&&void 0!=b.data.row&&(b=b.data);var f=document.documentElement.scrollLeft||document.body.scrollLeft,g=document.documentElement.scrollTop||document.body.scrollTop,t;if(b.points){var m=d3.mouse(this);t=this.getScreenCTM();m=q(b.points,m[0],m[1],!0,!0);b=m.d;t={x:m.x+t.e+f,y:m.y+t.f+g}}else t=e(this,b);if(m=c.content(b))x||(x=document.createElement("div"),document.body.appendChild(x)),x.setAttribute("class","brunel tooltip above"),
x.style.visibility="visible",x.style.width=null,x.innerHTML=m,m=h/3,x.offsetWidth>m&&(x.style.width=m+"px"),m=t.y-10-x.offsetHeight,2>m&&t.y<k/2&&(m=c.method,c.method="bottom",t=e(this,b),c.method=m,m=t.y+10,x.setAttribute("class","brunel tooltip below")),x.style.left=t.x-x.offsetWidth/2+"px",x.style.top=m+"px"}},u=function(){x&&(x.style.visibility="hidden")};return{install:e,installSnap:f,showFor:m,hide:u}}}},makePathSplits:function(a,b,c){return a._rows.map(a._split).filter(function(a,b,c){return c.indexOf(a)===
b}).map(function(e){var f=a._rows.filter(function(b){return a._split(b)==e});c&&f.sort(function(a,b){return c(a)-c(b)||a.row-b.row});var g=b(f),j=f[0].key,h=f[0].row,k=b.x(),l=b.y(),m,r=[];for(m=0;m<f.length;m++)r.push({x:k(f[m]),y:l(f[m]),d:f[m]});return{path:g,key:j,row:h,points:r}})},locate:function(a,b,c,e){var f,g,j={};for(f=0;f<e;f++)g=a.value(f),null!=g&&(j[g]=[b.value(f),c.value(f)]);return function(a){return j[a]||[null,null]}},addLegend:function(a,b){a.attr("class","legend").selectAll("text.title").data(["all"]).enter().append("text").attr("x",
0).attr("y",0).style("text-anchor","end").attr("dy","0.85em").text(b.title).attr("class","title");var c=a.selectAll("g.swatch").data(b.ticks).enter().append("g").attr("class","swatch").attr("transform",function(a,b){return"translate(-20,"+(20+20*b)+")"}),e=c.append("use").attr("x",2).attr("width",18).attr("height",18);b.color&&e.style("fill",b.color);e.attr("xlink:href",b.symbol?function(a){return"#"+b.symbol(a)}:"#_sym_square");e=b.ticks;if(b.dateFormat)e=function(a){return b.dateFormat.format(a)};
else if("number"==typeof e[0])var e=Math.abs(e[e.length-1]-e[0]),f=Math.max(0,4-Math.log(e)/Math.log(10)),e=2E6<e?function(a){return BrunelData.Data.formatNumeric(a/1E6,0,!0)+"M"}:function(a){return BrunelData.Data.formatNumeric(a,f,!0)};else e=function(a){return BrunelData.Data.format(a,!0)};c.append("text").attr("y",8).attr("dy",".35em").style("text-anchor","end").text(e).attr("class","legend").append("text").attr("x",0).attr("y",0)},centerInWedge:function(a,b){var c=a.select("textPath").node(),
f=d3.select(c.getAttribute("href")).node().getTotalLength()/2-b;c.getComputedTextLength()>f-4&&!e(c,c.textContent,f-4)?c.setAttribute("visibility","hidden"):c.setAttribute("startOffset",(f-c.getComputedTextLength())/2)},makeRowsWithKeys:function(a,b){for(var c=[],e=0;e<b;e++)c.push({row:e,key:a(e)});return c},label:function(a,b,c,e,f){function g(a){f.forEach(function(c){l(a,b,c,j,e)})}var j={D:f[0].granularity};return 0<c?a.transition("labels").duration(c).tween("func",function(a,b){var c=this;return function(){b||
(j={D:f[0].granularity});g(c)}}):a.each(function(){g(this)})},removeLabels:function(a){var b;if(a=a.__labels__)for(b in a)a[b]&&a[b].remove()},undoTransform:function(a,b){var c=b.node().getCTM();if(c){var e=a.node(),c=e.ownerSVGElement.createSVGTransformFromMatrix(c.inverse());e.transform.baseVal.initialize(c)}return a},cloudLayout:function(a,b,c){function e(a){var b=h(a);if(b){var c=b.height+b.y,f=0.9*c,g=b.height,b=b.width+2,j=0;0==a._ascDesc?g-=c+f:1==a._ascDesc?(g-=f,j+=f/2):2==a._ascDesc&&(g-=
c,j-=c/2);c={width:b,height:g,ox:0,oy:j};f=k.length;c._txt=a;k[f]=c;l+=c.height*c.width}}var f=Math.pow(0.8,Math.sqrt(a.rowCount()/200)),g=1*b[0]/Math.max(b[0],b[1]),j=1*b[1]/Math.max(b[0],b[1]),k=[],l=0;return{prepare:function(){var a=d3.select(this);if(this._originalSize)a.style("font-size",this._originalSize);else{a.style("alignment-baseline","auto");var b=getComputedStyle(this).fontSize;b.startsWith("0.")&&a.style("font-size","1.0");this._originalSize=a.style("font-size");a:{for(var a=this.textContent,
c,f=0,b=0;b<a.length;b++)if(c=a.charAt(b),0<="bdfhiklt1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(c))f|=1;else if(0<="gjpqy".indexOf(c))f|=2;else if(0>" \nacemnorsuvwxz.,-".indexOf(c)){a=3;break a}a=f}this._ascDesc=a}e(this)},build:function(){var a,h;h=Math.sqrt(b[0]*b[1]/l/2);var m=k;parent=k[0]._txt.parentNode;parent.removeAttribute("transform");k=[];for(a=0;a<m.length;a++){var t=d3.select(m[a]._txt),n=t.style("font-size"),q=n.substring(0,n.length-2),n=n.substring(n.length-2),q=Math.round(q*h)+
n;t.style("font-size",q);e(m[a]._txt)}t=k.slice();t.sort(function(a,b){return a.width/a.height-b.width/b.height});for(a=0;a<t.length/3;a++)m=t[a],h=m.height,m.height=m.width,m.width=h,m._rotated=!0;for(a=0;a<k.length;a++){h=k[a];q=!0;m=0;h.title=this.textContent;for(t=a-1;0<=t;t--)h.width>=f*k[t].width&&h.height>f*k[t].height&&(m=Math.max(m,k[t].theta));for(;q;){t=Math.cos(m);q=Math.sin(m);h.x=t*m*g;h.y=q*m*j;c&&(Math.abs(t)>Math.abs(q)?(h.x=0<t?m*g:-m*g,h.y*=Math.SQRT2):(h.y=0<q?m*j:-m*j,h.x*=Math.SQRT2));
h.theta=m;q=!1;for(t=a-1;0<=t;t--)if(h.y+h.height/2>k[t].y-k[t].height/2&&k[t].y+k[t].height/2>h.y-h.height/2&&h.x+h.width/2>k[t].x-k[t].width/2&&k[t].x+k[t].width/2>h.x-h.width/2){q=!0;break}m+=1/Math.max(1,Math.sqrt(h.x*h.x+h.y*h.y))}m="translate("+(h.x-h.ox)+","+(h.y+h.oy)+")";h._rotated&&(m+="rotate(90, 0, 0) ");h._txt.setAttribute("transform",m);d3.select(h._txt).style("alignment-baseline","middle")}a=parent;h=k.reduce(function(a,b){return Math.max(a,Math.abs(b.x)+b.width/2)},0);m=k.reduce(function(a,
b){return Math.max(a,Math.abs(b.y)+b.height/2)},0);h=Math.min(b[0]/h,b[1]/m)/2;a.setAttribute("transform","scale("+h+")");k=[];l=0}}},gridLayout:function(a,b,c,e,f){var g;a=a.leaves();c||(c=a.length,f=b[1]/b[0]/f,c=e?Math.ceil(c/e):Math.round(Math.sqrt(c*f)));f=-1;for(e=g=0;e<a.length;e++)++f>=c&&(f=0,g++),a[e].x=g,a[e].y=f;f=g+1;g=Math.min(b[0]/f,b[1]/c)/2;for(e=0;e<a.length;e++)a[e].x=(a[e].x+0.5)*b[0]/f,a[e].y=(a[e].y+0.5)*b[1]/c,a[e].r=g},prune:function(a,b,c,e){a.each(function(a){b[a.data.key]&&
(a.children=void 0,a.collapsed=!0,b[a.data.key]=!0)});j(a,c);for(var f=a.descendants().length;f>e&&2<e;){var g,h=[];a.each(function(a){a.depth&&(1==a.height&&null==b[a.data.key])&&h.push(a)});if(0==h.length)break;h.sort(function(a,b){return a.value-b.value});for(g=0;g<h.length&&f>e;g++){var k=h[g].descendants().length-1,l=h[g],m=b;l.children=void 0;l.collapsed=!0;m[l.data.key]=!0;f-=k}j(a,c)}if(c){var n=[];a.each(function(a){a.collapsed&&(n[a.depth]=(n[a.depth]||0)+1)});a.eachAfter(function(b){if(b.children)for(g=
b.value=0;g<b.children.length;g++)b.value+=b.children[g].value;b.collapsed&&(b.value=Math.min(b.value,a.value/n[b.depth])/10)})}},select:function(a,b,c,e){var g=d3.event||event,j=c.data();j.field("#selection");var h=g.altKey?"tog":"sel";g.shiftKey&&(h=g.altKey?"sub":"add");a=a?a.data&&null!=a.data.row?a.data.row:a.row:null;c.original().modifySelection(h,a,j,c.fields.key);e&&f(e,b)},transition:function(a,b,c){if(0<b){a=a.transition().duration(b);if(c)a.on("end",c);return a}c&&a.each(c);return a},sizedPath:function(){function a(b,
c,e){var f=Math.cos(e);e=Math.sin(e);return{a:{x:b.x+b.r*f,y:b.y+b.r*e,r:b.r},b:{x:c.x+c.r*f,y:c.y+c.r*e,r:c.r}}}function b(a,c){return{x:a.x-c.x,y:a.y-c.y}}function c(a,b){return(b?b:"")+a.x.toFixed(1)+" "+a.y.toFixed(1)}function e(a){var f,g=a[0],k,l=c(g.a);for(f=1;f<a.length;f++){k=a[f];var m;m=g;var t=k,n=b(m.b,m.a),q=b(t.b,t.a),t=b(t.a,m.a),M=n.x*q.y-n.y*q.x;0.01>Math.abs(M)?m=null:(q=(t.x*q.y-t.y*q.x)/M,n=(t.x*n.y-t.y*n.x)/M,m={hit:q>=j&&q<=h&&n>=j&&n<=h,p:{x:m.a.x+(m.b.x-m.a.x)*q,y:m.a.y+(m.b.y-
m.a.y)*q}});m?m.hit?l+=c(m.p,"L"):(m=k.a.r.toFixed(1),l+=c(g.b,"L")+"A"+m+" "+m+" 0 0 1 "+c(k.a)):l+=c(k.a,"L");g=k}return l+c(g.b,"L")}function f(b){if(2>b.length)return"";var c,g,j=b[0],h,k=[],l=[];for(c=1;c<b.length;c++)h=b[c],g=Math.atan2(j.y-h.y,j.x-h.x)+Math.PI/2,k.push(a(j,h,g)),g=a(j,h,g+Math.PI),l.push({a:g.b,b:g.a}),j=h;l.reverse();return"M "+e(k)+" L "+e(l)+"Z"}function g(a){var b,c,e,j,h=[],t=[],n="";for(b=0;b<a.length;b++)if(c=k.call(this,a[b],b),e=l.call(this,a[b],b),j=m.call(this,a[b],
b),c&&e&&j){if(c!=t.x||e!=t.y)h.push(t={x:c,y:e,r:j/2})}else n+=f(h),h=[];return n+f(h)}var j=-1E-6,h=1.000001,k=function(a){return a.x},l=function(a){return a.y},m=function(a){return a.r};g.x=function(a){if(!arguments.length)return k;k=a;return g};g.y=function(a){if(!arguments.length)return l;l=a;return g};g.r=function(a){if(!arguments.length)return m;m=a;return g};return g},tween:function(a,b,c){return b?a.transition("element").duration(b).tween("func",c):a.each(function(a,b){return c.call(this,
a,b)()})},addFeatures:function(a,b,c,e,f,g){var j=c?!0:!1;if(f._features){var h=[];for(b=0;b<a._rows.length;b++){var k=a._rows[b],l=e?e(k):null;if(l=f._features[l])k.geometry=l.geometry,k.type=l.type,k.geo_properties=l.properties,h.push(k)}a._rows=f._featureExtras.concat(h);return!1}f._features={};f._featureExtras=[];var h=1,m=Object.keys(b).length;for(k in b)new function(b,h,k){d3.json(b,function(b,l){var n,q,H={},r,s=l.objects.all.geometries;s.bbox||(s.bbox=[l.bbox[0],l.bbox[2],l.bbox[1],l.bbox[4]]);
if(j)if(e){var w=a._rows.map(e);for(n in w)h[w[n]]=w[n]}else h={};else c="a";for(n in h)H[h[n]]=n;s.forEach(function(a,b){r=topojson.feature(l,a);q=H[r.properties[c]];null!=q?f._features[q]=r:(f._featureExtras.push(r),r.key="#"+k+"-"+b)});--m||f.chart().build(g)})}(k,b[k],h++);return!0},edge:m,insetEdge:n,network:function(a,e,f,g,j,k,q){function s(e){var f,g,j,h,k=0;for(f=0;f<e.length;f++){j=e[f];for(g=0;g<u;g++){h=a.links[g];var l;l=j.source;var m=j.target,n=h.source;h=h.target;if(l===m||l===h||
n===m||n===h)l=0;else{var q=b(l,m,n),H=b(l,m,h),r=b(n,h,l),Q=b(n,h,m);l=q!==H&&r!==Q?!0:0===q&&c(l,n,m)||0===H&&c(l,h,m)||0===r&&c(n,l,h)||0===Q&&c(n,m,h)}l&&k++}}return k}function x(a,b){var c=a.x,e=a.y;a.x=b.x;b.x=c;a.y=b.y;b.y=e}var w=a.nodes.length,u=a.links.length,r=j.inner_width,z=j.inner_height,C=0;e.selection().each(function(a){var b=h(this);b&&(a.radius=+this.getAttribute("r")||b.getWidth(),C+=a.radius)});var C=C/a.nodes.length,G=j.default_point_size,B=j.inner_width-G,S=j.inner_height-G;
q=(q||1)*Math.min(r,z)/Math.sqrt(w)+C;var y=q*Math.max(1,q-3)/5/Math.max(1,u/w),y=Math.min(y,6*q),N,E,J;for(E=0;E<w;E++)N=6*Math.PI*E/w,J=a.nodes[E],J.x=J.x||r*(0.5+Math.cos(N)*Math.sqrt(E/w)/2),J.y=J.y||z*(0.5+Math.sin(N)*Math.sqrt(E/w)/2);var A=e.selection(),L=f.selection(),I="use"==A.node().tagName,O=0,P=d3.forceSimulation().force("link",d3.forceLink(a.links).distance(q)).force("center",d3.forceCenter(r/2,z/2)).force("charge",d3.forceManyBody().distanceMax(j.inner_radius/2).strength(-y)).force("inside",
function(){var b,c,e=a.nodes.length,f;for(b=0;b<e;b++)f=a.nodes[b],c=f.radius,f.x-c<G&&(f.vx+=G+c-f.x),f.x+c>B&&(f.vx+=B-c-f.x),f.y-c<G&&(f.vy+=G+c-f.y),f.y+c>S&&(f.vy+=S-c-f.y)});A.call(d3.drag().on("drag",function(a){a.fx=d3.event.x;a.fy=d3.event.y;0.25>P.alpha()&&P.alpha(0.25).restart()}).on("end",function(a){a.fx=a.fy=null}));return P.nodes(a.nodes).on("tick",function(){function b(a){return B.x+B.k*a}function c(a){return B.y+B.k*a}if(100>w&&(O++,!(O>w))){var f,h,q;for(f=0;f<w;f++){h=(f+O)%w;q=
a.nodes[f];h=a.nodes[h];var r;r=q;for(var K=h,C=void 0,F=void 0,z=[],C=0;C<u;C++)F=a.links[C],(F.source===r||F.target===r||F.source===K||F.target===K)&&z.push(F);r=z;K=s(r);x(q,h);s(r)>=K&&x(q,h)}}var B=d3.zoomTransform(g);I?A.attr("x",function(a){return b(a.x)-this.getAttribute("r")}).attr("y",function(a){return c(a.y)-this.getAttribute("r")}).attr("width",function(){return 2*this.getAttribute("r")}).attr("height",function(){return 2*this.getAttribute("r")}):A.attr("cx",function(a){return b(a.x)}).attr("cy",
function(a){return c(a.y)});A.each(function(a){var e,f,g=this.__labels__;if(g)for(e in g)f=g[e],f.__off__?(f.attr("x",b(f.__off__.dx+a.x)),f.attr("y",c(f.__off__.dy+a.y))):(l(this,null,f.__labeling__,null,j),f.__off__={dx:+f.attr("x")/B.k+B.x-a.x,dy:+f.attr("y")/B.k+B.y-a.y})});L.attr("d",function(a){return(a=n(b(a.source.x),c(a.source.y),a.source,b(a.target.x),c(a.target.y),a.target))?m(a,k):null});e.buildFacet&&e.buildFacet()})},makeNode:function(a){var b=h(a);if(!b)return null;var c=Math.max(b.width,
b.height)/2;if("path"==a.tagName||"poly"==a.tagName)c=Math.min(20,c/3);return{x:b.x+b.width/2,y:b.y+b.height/2,radius:c}},makeEdge:function(a,b){var c=a.key.split("|");if(2!=c.length)return null;var e=b[c[0]],c=b[c[1]];return e&&c?{source:e,target:c,key:a.key,row:a.row}:null},facet:function(a,b,c){b.selection().each(function(e){e=0<=e.row?e.row:e.data?e.data.row:null;null!=e&&(e=b.data().field("#row").value(e),a(this,(e.items?e.items:[e]).map(function(a){return a-1})).build(c))})},time:function(a){if(console){var b=
(new Date).getTime();I&&console.log("[Time] "+R+" -> "+a+":\t"+(b-I));I=b;R=a}},interpolate:function(a,b,c){return(a+b)/2+c*(b-a)},animateBuild:function(a,b,c){function e(a){var c,f,g,j={},k=[];h.elements.forEach(function(e){if(f=e.fields[a])for(c=0;c<f.length;c++)if(g=f[c],!(j[g]||"'"==g[0])){a:{e=g;if("#"!=e.charAt(0)&&b.options)for(var h=0;h<b.names.length;h++)if(b.names[h]==e){e="string"!=b.options[h];break a}e=!0}e&&k.push(g,g+"$lower",g+"$upper");j[g]=!0}});return k}function f(a){a=this.field(a);
if(!a)return null;if(a.oProvider)return a;a.oProvider=a.provider;var b=BrunelData.values_ConstantProvider,c;"size"==q?c=1E-6:k&&k[q]?(c=k[q].domain(),c=0==c[0]?0:(c[0]+c[c.length-1])/2):c=a.min();a.provider=new b(c,a.rowCount());return a}if(1!=a.charts.length)return a.build(b);var g,j=["size","y","color"],h=a.charts[0],k=h.scales,l=a.dataPostProcess(),m=[],n,q;for(g=0;g<j.length&&!m.length;g++)m=e(q=j[g]);if(!m.length)return a.build(b);a.dataPostProcess(function(a){n=m.map(f,a);return l(a)});a.build(b);
a.dataPostProcess(l);n&&n.forEach(function(a){a&&(a.provider=a.oProvider)});a.rebuild(c)},makeGrid:function(a,b,c,e){var f,g;b.ticks?(g=b.ticks(),f=function(a){return b(a)}):(g=b.range(),f=function(a){return a});a=a.selectAll("line.grid."+(e?"x":"y")).data(g);g=a.enter().append("line").attr("class","grid "+(e?"x":"y")).merge(a);e?g.attr("y1",0).attr("y2",c).attr("x1",f).attr("x2",f):g.attr("x1",0).attr("x2",c).attr("y1",f).attr("y2",f);a.exit().remove()},crosshairs:function(a,b,c,e){function f(a){a.invert=
function(b){for(var c=a.domain(),e=0,f=c.length-1,g;1<f-e;)g=Math.floor((e+f)/2),a(c[g])>b?f=g:e=g;return b-a(c[e])<a(c[f])-b?c[e]:c[f]}}var g,j=c.chart().scales;if((g=c.group())&&j&&j.x&&j.y){var k=g.selectAll("g.crosshairs");if(k.empty()){k=g.append("g").attr("class","crosshairs");for(g=0;4>g;g++)k.append("line").attr("class","dim"+Math.floor(g/2)+" part"+g);k.append("circle");k.append("text").attr("class","dim0").attr("dy","-0.3em");k.append("text").attr("class","dim1").attr("dy","-0.3em")}if(a){if(a.points)b=
d3.mouse(b),p=q(a.points,b[0],b[1],e),a=p.x,e=p.y;else{e=h(b);if(!e)return;a=e.x+e.width/2;e=e.y+e.height/2}j.x.invert||f(j.x);j.y.invert||f(j.y);var l=j.x.invert(a),m=j.y.invert(e);b=j.x.range()[0];g=j.x.range()[1];var n=j.y.range()[0],j=j.y.range()[1],l=c.data().field(c.fields.x[0]).format(l);c=c.data().field(c.fields.y[0]).format(m);k.selectAll("line.dim0").attr("x1",a).attr("x2",a);k.selectAll("line.dim1").attr("y1",e).attr("y2",e);k.select("line.part0").attr("y1",n).attr("y2",e+10);k.select("line.part1").attr("y1",
e-10).attr("y2",j);k.select("line.part2").attr("x1",b).attr("x2",a-10);k.select("line.part3").attr("x1",a+10).attr("x2",g);k.select("circle").attr("cx",a).attr("cy",e).attr("r",10);k.select("text.dim0").attr("x",a).attr("y",n).text(" "+l);k.select("text.dim1").attr("y",e).attr("x",b).text(" "+c);k.style("visibility","visible")}else k.style("visibility","hidden")}},filterTicks:function(a){var b=a.domain();if(3>b.length)return b;a=a.range();a=Math.abs(a[1]-a[0]);var c=Math.ceil(16*b.length/a);return 2>
c?b:b.filter(function(a,b){return!(b%c)})},closestOnPath:q,closest:s,panzoom:function(a,b){var c=b.translate()[0],e=b.translate()[1],f=b.scale();a&&(c=a.dx||c,e=a.dy||e,f=a.s||f,b.translate([c,e]).scale(f));return{dx:c,dy:e,s:f}},restrictZoom:function(a,b,c){var e=a.x,f=a.y;a=a.k;var g=b.inner_width;b=b.inner_height;var j=0.5*g,h=0.5*b;e+a*g<j&&(e=j-a*g);e>g-j&&(e=g-j);f+a*b<h&&(f=h-a*b);f>b-h&&(f=b-h);e=d3.zoomIdentity.translate(e,f).scale(a);return c.__zoom=e},zoomLabel:function(a){var b=1<a?"zoomIn zoomIn":
"zoomOut zoomOut";a=Math.round(1<a?a:1/a);return 1==a?"zoomNone":5>=a?b+a:10>=a?b+"High":b+"Extreme"},geoStream:function(a){var b,c,e;return d3.geoTransform({lineStart:function(){c=e=null;this.stream.lineStart()},lineEnd:function(){c=e=null;this.stream.lineEnd()},point:function(f,g){-85<g&&(150<c&&-150>f&&(f=Math.min(180,f+360)),-150>c&&150<f&&(f=Math.max(-180,f-360)));c=f;if((b=a([f,g]))&&!(e&&0.7>(e[0]-b[0])*(e[0]-b[0])+(e[1]-b[1])*(e[1]-b[1])))e=b,this.stream.point(b)}})},winkel3:function(){return d3.geoProjection(function(a,
b){var c=Math.acos(Math.cos(b)*Math.cos(a/2)),c=1E-6>Math.abs(c)?1:Math.sin(c)/c;return[Math.cos(b)*Math.sin(a/2)/c+a/Math.PI,(Math.sin(b)*c+b)/2]})},setAspect:function(a,b,c){if(a.domain()&&!(2!=a.domain().length||!b.domain()||2!=b.domain().length)){var e=0!=a.range()[1]?a.range()[1]:a.range()[0],f=0!=b.range()[0]?b.range()[0]:b.range()[1],g=a.domain()[0].getTime,j=b.domain()[0].getTime,h=BrunelData.Data.asNumeric(a.domain()[1]),k=BrunelData.Data.asNumeric(a.domain()[0]),l=BrunelData.Data.asNumeric(b.domain()[1]),
m=BrunelData.Data.asNumeric(b.domain()[0]),n=k>h?-1:1,q=m>l?-1:1,h=Math.abs(h-k),l=Math.abs(l-m),l=Math.max(h/e,l/f);c=k+c*l*e*n;f=m+l*f*q;g&&(k=BrunelData.Data.asDate(k),c=BrunelData.Data.asDate(c));j&&(m=BrunelData.Data.asDate(m),f=BrunelData.Data.asDate(f));a.domain([k,c]);b.domain([m,f])}},hasData:y,isSelected:function(a){return function(b){return"✓"==a.$selection(b)}},copyTreeLayoutInfo:function(a,b,c){function e(a,b){a.x||(a.x=b.x,a.y=b.y);a.children&&a.children.forEach(function(b){e(b,a)})}
a.forEach(function(a){a.data.x=a.x+=c;a.data.y=a.y+=c});e(b.root,{x:void 0,y:void 0});b.links&&(b.links=b.links.filter(function(a){return!isNaN(a.source.x+a.target.x)}))},addDefinitions:function(a){a.selectAll("defs").data(["X"]).enter().append("defs").html('<g><symbol id="_sym_circle" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/></symbol><symbol id="_sym_square" viewBox="0 0 24 24"><path d="M3,3V21H21V3Z"/></symbol><symbol id="_sym_triangle" viewBox="0 0 24 24"><path d="M1,21H23L12,2Z"/></symbol><symbol id="_sym_diamond" viewBox="0 0 24 24"><path d="M21.5,10.8L13.2,2.5C12.5,1.8 11.5,1.8 10.8,2.5L2.5,10.8C1.8,11.5 1.8,12.5 2.5,13.2L10.8,21.5C11.5,22.2 12.5,22.2 13.2,21.5L21.5,13.2C22.1,12.5 22.1,11.5 21.5,10.8Z"/></symbol><symbol id="_sym_cross" viewBox="0 0 24 24"><path d="M23,16H16V23H8V16H1V8H8V1H16V8H23V16Z"/></symbol><symbol id="_sym_pentagon" viewBox="0 0 24 24"><path d="M12,2.5L2,9.8L5.8,21.5H18.2L22,9.8L12,2.5Z"/></symbol><symbol id="_sym_star" viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"/></symbol><symbol id="_sym_hexagon" viewBox="0 0 24 24"><path d="M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5Z"/></symbol></g><g><linearGradient id="_gradient_linear_blue" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:rgb(11, 155, 219)"/><stop offset="100%" style="stop-color:rgba(11, 155, 219, 0);stop-opacity:0" /></linearGradient><linearGradient id="_gradient_linear_red" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:rgb(242, 87, 76)"/><stop offset="100%" style="stop-color:rgba(242, 87, 76, 0);stop-opacity:0" /></linearGradient><radialGradient id="_gradient_radial_blue" cx="50%" cy="50%" r="50%" y2="100%"><stop offset="0%" style="stop-color:rgb(11, 155, 219)"/><stop offset="100%" style="stop-color:rgba(11, 155, 219, 0);stop-opacity:0" /></radialGradient><radialGradient id="_gradient_radial_red" cx="50%" cy="50%" r="50%" y2="100%"><stop offset="0%" style="stop-color:rgb(242, 87, 76)"/><stop offset="100%" style="stop-color:rgba(242, 87, 76, 0);stop-opacity:0" /></radialGradient></g>')}}}();var BrunelData=function(){var h={extend:function(a,b){var c,e=b.prototype;a.prototype=new function(){};a.prototype.constructor=a;a.$superConstructor=b;a.$super=e;for(c in e)e.hasOwnProperty(c)&&(a.prototype[c]=e[c])},superconstruct:function(a){a.constructor.$superConstructor.apply(a,Array.prototype.slice.call(arguments,1))},extendEnum:function(a){var b=[],c=0,e;for(e in a)if(a.hasOwnProperty(e)){var f=a[e];f.constructor==a&&"prototype"!=e&&(f._ordinal=c++,f._name=e,f.toString=function(){return this._name},
f.ordinal=function(){return this._ordinal},b.push(f))}a.values=function(){return b};a.valueOf=function(a){for(var c in b)if(b[c]._name==a)return b[c];return null}},copy:function(a,b){for(var c in b)a[c]=b[c]},iter:function(a){return new h.Iterator(a)},equals:function(a,b){return a===b?!0:null===a||null===b||typeof a!=typeof b?!1:"function"==typeof b.equals?a.equals(b):"function"==typeof a.getTime?a.getTime()==b.getTime():a==b},hash:function(a){return!a?"#":"function"==typeof a.hashCode?a.hashCode():
"#"+String(a)},toArray:function(a){return a.constructor===Array?a:"function"==typeof a.toArray?a.toArray():[a]},Array:function(a,b){var c=Array(a),e=a;if(2<arguments.length)for(var f=Array.prototype.slice.call(arguments,1);e--;)c[e]=h.Array.apply(this,f);else for(e=0;e<a;e++)c[e]=b;return c},compare:function(a,b){if(null==a)return null==b?0:1;if(null==b)return-1;var c=typeof a,e=typeof b;if(c<e)return-1;if(c>e)return 1;if("function"==typeof a.compareTo)return a.compareTo(b);"function"==typeof a.getTime&&
(a=a.getTime(),b=b.getTime());return a<b?-1:a>b?1:0},addAll:function(a,b){for(var c=0;c<b.length;c++)a.add(b[c])},sort:function(a,b){"function"==typeof b?a.sort(b):b?a.sort(function(a,e){return b.compare.call(b,a,e)}):a.sort(h.compare)},toString:function(a){if(!a)return null;if(Array.isArray(a)){var b,c;for(b in a)a.hasOwnProperty(b)&&(c=c?c+(", "+h.toString(a[b])):"["+h.toString(a[b]));return c+"]"}return"function"==typeof a.toString?a.toString():""+a},copyOf:function(a,b){var c,e=h.Array(b,0),f=
Math.min(b,h.len(a));for(c=0;c<f;c++)e[c]=a[c];return e},fill:function(a,b){for(i in a)a.hasOwnProperty(i)&&(a[i]=b)},len:function(a){a=a.length;return"function"==typeof a?a():a},startsWith:function(a,b){return 0==a.indexOf(b)},endsWith:function(a,b){return a.lastIndexOf(b)==a.length-b.length},equalsIgnoreCase:function(a,b){return a===b?!0:null==a||null==b?!1:a.toLowerCase()==b.toLowerCase()},isEmpty:function(a){return a.isEmpty?a.isEmpty():0==h.len(a)},addGrouping:function(a){var b,c="-"==a.charAt(0)?
1:0;b=a.lastIndexOf(".");0>b&&(b=a.length);for(b-=3;b>c;b-=3)a=a.substring(0,b)+","+a.substring(b);return a},formatInt:function(a,b){var c=""+Math.round(a);return b?this.addGrouping(c):c},formatScientific:function(a){return a.toExponential(3).replace(/[0]?0e/,"e").replace("+","")},formatFixed:function(a,b,c){a=a.toFixed(b).replace(/[.]?0*$/,"");return c?this.addGrouping(a):a},parseDate:function(a){var b=a.indexOf(":"),c=a,e=0,f=0,g=0;if(0<b){for(e=b-1;0<=e&&-1!="0123456789".indexOf(a[e]);)e--;c=0>
e?"":a.substring(0,e).trim();a=a.substring(e+1).trim().split(":");e=parseInt(a[0],10);f=parseInt(a[1],10);2<a.length&&(g=parseInt(a[2],10))}if(0==c.length)return new Date(Date.UTC(1970,0,1,e,f,g));if(-1!=c.indexOf("-"))return a=c.split("-"),c=parseInt(a[0],10),b=parseInt(a[1],10)-1,a=parseInt(a[2],10),new Date(Date.UTC(c,b,a,e,f,g));if(!isNaN(c))return null;c=new Date(c);return isNaN(c.getTime())?null:new Date(c.getTime()+1E3*(60*(60*e+f-c.getTimezoneOffset())+g))},assertEquals:function(a,b,c){if(null!=
c&&!(Math.abs(a-b)<c)||null==c&&!h.equals(a,b))throw"Expected "+a+", but was "+b;},assertNotEquals:function(a,b){if(a==b)throw"Expected inequality, but both were "+a;},assertTrue:function(a){if(!a)throw"Was not true";},Exception:function(a){this.message=a},List:function(a){this.items=[];if(a){a=h.toArray(a);for(var b=0;b<a.length;b++)this.items[b]=a[b]}},Map:function(){this.clear()},Set:function(){this.clear()},Iterator:function(a){a instanceof h.List?(this.target=a,this.useGet=!0,this.N=a.size()):
(this.target=h.toArray(a),this.useGet=!1,this.N=this.target.length);this.i=-1;this.current=this.next()}};h.Iterator.prototype={hasNext:function(){return void 0!==this.current},next:function(){return this.current=++this.i>=this.N?void 0:this.useGet?this.target.get(this.i):this.target[this.i]}};h.Exception.prototype={getMessage:function(){return this.message},toString:function(){return this.message}};h.List.prototype={add:function(a){this.items.push(void 0===a?null:a)},addAll:function(a){this.items=
this.items.concat(h.toArray(a))},get:function(a){return this.items[a]},set:function(a,b){this.items[a]=b},sort:function(a){h.sort(this.items,a)},clear:function(){this.items=[]},size:function(){return this.items.length},toArray:function(){return[].concat(this.items)},isEmpty:function(){return 0==this.items.length},remove:function(a){this.items.splice(a,1)},contains:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b]==a)return!0;return!1},indexOf:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b]==
a)return b;return-1},toString:function(){return"["+this.items.join(", ")+"]"}};h.Map.prototype={size:function(){return this.count},clear:function(){this.items={};this.count=0},isEmpty:function(){return 0==this.count},put:function(a,b){var c=h.hash(a),e=this.items[c];if(!e)return e=[[a,b]],this.items[c]=e,this.count++,null;c=this._findInArray(a,e);if(0>c)return e.push([a,b]),this.count++,null;var f=e[c][1];e[c][1]=b;return f},remove:function(a){var b=this.items[h.hash(a)];a=this._findInArray(a,b);
if(0>a)return null;this.count--;return b.splice(a,1)[0][1]},putAll:function(a){var b,c,e=a.items;for(b in e)if(e.hasOwnProperty(b)){a=e[b];for(c=0;c<a.length;c++)this.put(a[c][0],a[c][1])}},values:function(){var a,b,c,e=new h.List,f=this.items;for(a in f)if(f.hasOwnProperty(a)){b=f[a];for(c=0;c<b.length;c++)e.add(b[c][1])}return e},get:function(a){var b=this.items[h.hash(a)];a=this._findInArray(a,b);return 0<=a?b[a][1]:null},keySet:function(){var a,b,c,e=new h.Set,f=this.items;for(a in f)if(f.hasOwnProperty(a)){b=
f[a];for(c=0;c<b.length;c++)e.add(b[c][0])}return e},containsKey:function(a){var b=this.items[h.hash(a)];return 0<=this._findInArray(a,b)},toArray:function(){var a,b,c,e=[],f=this.items;for(a in f)if(f.hasOwnProperty(a)){b=f[a];for(c=0;c<b.length;c++)e.push(b[c][0])}return e},toString:function(){var a=this;return"{"+this.toArray().map(function(b){return b+"="+a.get(b)}).join(", ")+"}"},_findInArray:function(a,b){if(b)for(var c=0;c<b.length;c++)if(h.equals(a,b[c][0]))return c;return-1}};h.extend(h.Set,
h.Map);h.Set.prototype.contains=h.Set.prototype.containsKey;h.Set.prototype.add=function(a){return!this.put(a,a)};h.Set.prototype.addAll=h.Set.prototype.putAll;h.Set.prototype.toString=function(){return"["+this.toArray().join(", ")+"]"};if(!String.prototype.trim){var A=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(A,"")}}Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var g={version:"0.0.3",util_Informative:function(){this.info=
new h.Map}};h.copy(g.util_Informative.prototype,{copyProperties:function(a){var b=Array.prototype.slice.call(arguments,1),c,b=h.iter(b);for(c=b.current;b.hasNext();c=b.next())this.set(c,a.property(c))},copyAllProperties:function(a){this.info.putAll(a.info)},intProperty:function(a){a=g.Data.asNumeric(this.property(a));return null==a?null:a},numProperty:function(a){return g.Data.asNumeric(this.property(a))},property:function(a){return this.info.get(a)},strProperty:function(a){a=this.property(a);return null==
a?null:a.toString()},isProperty:function(a){a=this.property(a);return null!=a&&a},set:function(a,b){null==b?this.info.remove(a):this.info.put(a,b)}});g.Dataset=function(a,b){var c,e;h.superconstruct(this);this.fieldByName=this.fields=null;this.fields=g.Dataset.ensureUniqueNames(a);this.fieldByName=new h.Map;c=h.iter(a);for(e=c.current;c.hasNext();e=c.next())this.fieldByName.put(e.name.toLowerCase(),e);c=h.iter(a);for(e=c.current;c.hasNext();e=c.next())this.fieldByName.put(e.name,e);null!=b&&this.copyAllProperties(b)};
h.extend(g.Dataset,g.util_Informative);h.copy(g.Dataset,{makeTyped:function(a,b,c){return g.Dataset.makeFullyDescribed(a,null,b,c)},makeFullyDescribed:function(a,b,c,e){var f,j,k,l,m,n,q,s=h.Array(a.length,null);for(k=0;k<s.length;k++){m=c[k].split("-");n=(l="range"==m[0])?m[1]:m[0];f="date"==n?g.util_DateFormat.valueOf(l?m[2]:m[1]):null;m=h.Array(e.length,null);for(j=0;j<m.length;j++)q=e[j][k],m[j]=null==q?null:l?null==f?g.util_Range.makeNumeric(g.Data.asNumeric(q[0]),g.Data.asNumeric(q[1]),!1):
g.util_Range.makeDateNative(g.Data.asDate(q[0]),g.Data.asDate(q[1]),!1,f):"numeric"==n?g.Data.asNumeric(q):"date"==n?g.Data.asDate(q):q.toString();l=null!=b?b[k]:null;s[k]=new g.Field(a[k],l,new g.values_ColumnProvider(m));"numeric"==n&&s[k].setNumeric();"date"==n&&(s[k].set("date",!0),s[k].setNumeric());"list"==n&&(s[k]=g.Data.toList(s[k]))}return g.Dataset.make(s,!1)},make:function(a,b){var c,e,f,j;a=g.Dataset.ensureUniqueNames(a);e=new h.List;j=new h.Set;c=h.iter(a);for(f=c.current;c.hasNext();f=
c.next())!1!=b&&(f=g.auto_Auto.convert(f)),e.add(f),j.add(f.name);c=0==a.length?0:a[0].rowCount();j.contains("#count")||e.add(g.Fields.makeConstantField("#count","Count",1,c));j.contains("#row")||e.add(g.Fields.makeIndexingField("#row","Row",c));j.contains("#selection")||e.add(g.Fields.makeConstantField("#selection","Selection","✗",c));e=e.toArray();return new g.Dataset(e,null)},ensureUniqueNames:function(a){var b,c,e,f,g=new h.Set;g.add("");f=h.Array(a.length,null);for(b=0;b<a.length;b++){e=a[b].name;
null==e&&(e="");if(g.contains(e))for(c=1;c<a.length+1;c++){if(!g.contains(e+"_"+c)){f[b]=a[b].rename(e+"_"+c,e);break}}else f[b]=a[b];g.add(f[b].name)}return f}});h.copy(g.Dataset.prototype,{retainRows:function(a){var b,c=h.Array(this.fields.length,null);for(b=0;b<c.length;b++)c[b]=g.Fields.permute(this.fields[b],a,!1);return this.replaceFields(c)},transform:function(a){return this.isSummarized()?this:g.modify_Transform.transform(this,a)},removeSpecialFields:function(){var a,b,c=new h.List;a=h.iter(this.fields);
for(b=a.current;a.hasNext();b=a.next())h.startsWith(b.name,"#")||c.add(b);a=c.toArray();return this.replaceFields(a)},addConstants:function(a){return g.modify_AddConstantFields.transform(this,a)},expectedSize:function(){var a,b,c=56*this.fields.length+56;a=h.iter(this.fields);for(b=a.current;a.hasNext();b=a.next())c+=b.expectedSize();return c},field:function(a,b){var c=this.fieldByName.get(a);return null!=c||!b?c:this.fieldByName.get(a.toLowerCase())},fieldArray:function(a){var b,c=h.Array(a.length,
null);for(b=0;b<c.length;b++)c[b]=this.field(a[b],!1);return c},filter:function(a){return g.modify_Filter.transform(this,a)},each:function(a){return this.isSummarized()?this:g.modify_Each.transform(this,a)},replaceFields:function(a){return new g.Dataset(a,this)},rowCount:function(){return 0==this.fields.length?0:this.fields[0].rowCount()},name:function(){return this.strProperty("name")},reduce:function(a){var b,c,e=new h.Set;h.addAll(e,g.modify_DataOperation.strings(a,";"));c=new h.List;a=h.iter(this.fields);
for(b=a.current;a.hasNext();b=a.next())(h.startsWith(b.name,"#")||e.contains(b.name))&&c.add(b);return this.replaceFields(c.toArray())},series:function(a){return g.modify_ConvertSeries.transform(this,a)},setRowCount:function(a){return g.modify_SetRowCount.transform(this,a)},sort:function(a){return g.modify_Sort.transform(this,a,!0)},sortRows:function(a){return g.modify_Sort.transform(this,a,!1)},stack:function(a){return g.modify_Stack.transform(this,a)},summarize:function(a){return this.isSummarized()?
this:g.modify_Summarize.transform(this,a)},isSummarized:function(){return!0==this.property("summarized")},modifySelection:function(a,b,c,e){var f,j=g.Field.VAL_UNSELECTED,k=g.Field.VAL_SELECTED,l=this.field("#selection"),m=this.rowCount();if("sel"==a)for(f=0;f<m;f++)l.setValue(j,f);f=c.expandedOriginalRows(b,e);b=h.iter(f);for(f=b.current;b.hasNext();f=b.next())switch(a){case "sel":case "add":l.setValue(k,f);break;case "sub":l.setValue(j,f);break;default:l.setValue(l.value(f)==k?j:k,f)}},expandedOriginalRows:function(a,
b){var c,e,f,j,k,l,m=new h.Set;if(null==a)return m;k=this.rowCount();c=this.fieldArray(b);c=new g.summary_FieldRowComparison(c,null,!1);l=this.field("#row");for(e=0;e<k;e++)if(0==c.compare(e,a))if(f=l.value(e),f instanceof g.util_ItemsList){j=f;for(f=0;f<j.size();f++)m.add(j.get(f)-1)}else null!=f&&m.add(f-1);return m}});g.util_MapInt=function(){this.map=new h.Map;this.maxCount=this.totalCount=0};h.copy(g.util_MapInt.prototype,{get:function(a){a=this.map.get(a);return null==a?0:a},getCounts:function(a){var b,
c=h.Array(a.length,0);for(b=0;b<c.length;b++)c[b]=this.get(a[b]);return c},getIndexedKeys:function(){var a,b,c=h.Array(this.size(),null);a=h.iter(this.map.keySet());for(b=a.current;a.hasNext();b=a.next())c[this.map.get(b)]=b;return c},increment:function(a){var b;null!=a&&(b=this.get(a)+1,this.map.put(a,b),this.totalCount++,this.maxCount=Math.max(this.maxCount,b))},getTotalCount:function(){return this.totalCount},mode:function(){var a,b,c;if(h.isEmpty(this))return null;b=new h.List;a=h.iter(this.map.keySet());
for(c=a.current;a.hasNext();c=a.next())this.map.get(c)==this.maxCount&&b.add(c);a=b.toArray();g.Data.sort(a);return a[Math.floor((a.length-1)/2)]},index:function(a){var b;a=h.iter(a);for(b=a.current;a.hasNext();b=a.next())this.map.containsKey(b)||this.map.put(b,this.map.size());return this},isEmpty:function(){return h.isEmpty(this.map)},size:function(){return this.map.size()},sortedKeys:function(){var a=this.map.keySet().toArray();g.Data.sort(a);return a}});g.util_DateUnit=function(a,b){this.approxDaysPerUnit=
a;this.base=b};h.copy(g.util_DateUnit,{floor:function(a,b,c){if(b==g.util_DateUnit.day)return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),g.util_DateUnit.floorNumeric(a.getUTCDate(),c,1)));if(b==g.util_DateUnit.week)return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),g.util_DateUnit.floorNumeric(a.getUTCDate(),7*c,1)));if(b==g.util_DateUnit.month)return new Date(Date.UTC(a.getUTCFullYear(),g.util_DateUnit.floorNumeric(a.getUTCMonth(),c,0)));if(b==g.util_DateUnit.quarter)return new Date(Date.UTC(a.getUTCFullYear(),
g.util_DateUnit.floorNumeric(a.getUTCMonth(),3*c,0)));if(b==g.util_DateUnit.year)return new Date(Date.UTC(g.util_DateUnit.floorNumeric(a.getUTCFullYear(),c,0),0));if(b==g.util_DateUnit.decade)return new Date(Date.UTC(g.util_DateUnit.floorNumeric(a.getUTCFullYear(),10*c,0),0));if(b==g.util_DateUnit.century)return new Date(Date.UTC(g.util_DateUnit.floorNumeric(a.getUTCFullYear(),100*c,0),0));var e=new Date(a.getTime());if(b==g.util_DateUnit.second)e.setUTCSeconds(g.util_DateUnit.floorNumeric(a.getUTCSeconds(),
c,0));else if(b==g.util_DateUnit.minute)e.setUTCSeconds(0),e.setUTCMinutes(g.util_DateUnit.floorNumeric(a.getUTCMinutes(),c,0));else if(b==g.util_DateUnit.hour)e.setUTCSeconds(0),e.setUTCMinutes(0),e.setUTCHours(g.util_DateUnit.floorNumeric(a.getUTCHours(),c,0));else if(b==g.util_DateUnit.hour)e.setUTCSeconds(0),e.setUTCMinutes(0),e.setUTCHours(g.util_DateUnit.floorNumeric(a.getUTCHours(),c,0));else throw"Invalid date unit "+b;return e},floorNumeric:function(a,b,c){return b*Math.floor((a-c)/b)+c},
increment:function(a,b,c){a=new Date(a.getTime());b==g.util_DateUnit.second?a.setUTCSeconds(a.getUTCSeconds()+c):b==g.util_DateUnit.minute?a.setUTCMinutes(a.getUTCMinutes()+c):b==g.util_DateUnit.hour?a.setUTCHours(a.getUTCHours()+c):b==g.util_DateUnit.day?a.setUTCDate(a.getUTCDate()+c):b==g.util_DateUnit.week?a.setUTCDate(a.getUTCDate()+7*c):b==g.util_DateUnit.month?a.setUTCMonth(a.getUTCMonth()+c):b==g.util_DateUnit.quarter?a.setUTCMonth(a.getUTCMonth()+3*c):b==g.util_DateUnit.year?a.setUTCFullYear(a.getUTCFullYear()+
c):b==g.util_DateUnit.decade?a.setUTCFullYear(a.getUTCFullYear()+10*c):b==g.util_DateUnit.century&&a.setUTCFullYear(a.getUTCFullYear()+100*c);return a}});g.util_DateUnit.century=new g.util_DateUnit(36500,10);g.util_DateUnit.decade=new g.util_DateUnit(3650,10);g.util_DateUnit.year=new g.util_DateUnit(365,10);g.util_DateUnit.quarter=new g.util_DateUnit(91.25,4);g.util_DateUnit.month=new g.util_DateUnit(30,4);g.util_DateUnit.week=new g.util_DateUnit(7,4);g.util_DateUnit.day=new g.util_DateUnit(1,7);
g.util_DateUnit.hour=new g.util_DateUnit(1/24,24);g.util_DateUnit.minute=new g.util_DateUnit(1/24/60,60);g.util_DateUnit.second=new g.util_DateUnit(1/24/3600,60);h.extendEnum(g.util_DateUnit);g.util_ItemsList=function(a){this.displayCount=12;this.items=a};h.copy(g.util_ItemsList.prototype,{equals:function(a){return this==a||a instanceof g.util_ItemsList&&0==this.compareTo(a)},hashCode:function(){var a,b,c=1;a=h.iter(this.items);for(b=a.current;a.hasNext();b=a.next())c=31*c+(null==b?0:h.hash(b));return c},
compareTo:function(a){var b,c,e=Math.min(this.size(),a.size());for(c=0;c<e;c++)if(b=g.Data.compare(this.get(c),a.get(c)),0!=b)return b;return this.size()-a.size()},get:function(a){return this.items[a]},size:function(){return this.items.length},setDisplayCount:function(a){this.displayCount=a},format:function(a,b){var c,e,f,j="",h=this.size();for(e=0;e<h;e++){0<e&&(j+=", ");if(e==this.displayCount-1&&h>this.displayCount)return j+"…";f=this.get(e);null!=b?(f=b.format(g.Data.asDate(f)),c=f.indexOf(","),
0<c?(j+=f.substring(0,c),j+=f.substring(c+1)):j+=f):a?(c=g.Data.asNumeric(f),j=null!=c?j+g.Data.formatNumeric(c,null,!1):j+f.toString()):j+=f.toString()}return j}});g.util_Range=function(a,b,c,e){this.low=a;this.high=b;this.mid=c;this.name=e};h.copy(g.util_Range,{make:function(a,b,c){return null==a||null==b?null:null==c?g.util_Range.makeNumeric(a,b,!1):g.util_Range.makeDate(a,b,!1,c)},makeNumeric:function(a,b,c){var e=(b+a)/2,f=2*(b-a)+1;c=c?g.util_Range.formatV(e,f):g.util_Range.formatV(a,f)+"…"+
g.util_Range.formatV(b,f);return new g.util_Range(a,b,e,c)},formatV:function(a,b){return 2E6<b?g.Data.formatNumeric(a/1E6,null,!1)+"M":g.Data.formatNumeric(a,null,!0)},makeDateNative:function(a,b,c,e){var f=g.Data.asDate((g.Data.asNumeric(a)+g.Data.asNumeric(b))/2);c=c?e.format(f):e.format(a)+"…"+e.format(b);return new g.util_Range(a,b,f,c)},makeDate:function(a,b,c,e){var f=g.Data.asDate(a),j=g.Data.asDate(b);a=g.Data.asDate((b+a)/2);c=c?e.format(a):e.format(f)+"…"+e.format(j);return new g.util_Range(f,
j,a,c)}});h.copy(g.util_Range.prototype,{compareTo:function(a){return g.Data.compare(this.asNumeric(),a.asNumeric())},asNumeric:function(){return(g.Data.asNumeric(this.low)+g.Data.asNumeric(this.high))/2},extent:function(){return g.Data.asNumeric(this.high)-g.Data.asNumeric(this.low)},hashCode:function(){return this.name},equals:function(a){return this==a||a instanceof g.util_Range&&h.equals(a.low,this.low)&&h.equals(a.high,this.high)},toString:function(){return this.name}});g.util_DateFormat=function(){};
h.copy(g.util_DateFormat.prototype,{format:function(a){a=a.toUTCString().split(" ");var b=this.toString();if("HourMinSec"==b)return a[4];if("Year"==b)return a[3];if("YearMonth"==b)return a[2]+" "+Number(a[3]);if("YearMonthDay"==b)return a[2]+" "+Number(a[1])+", "+Number(a[3]);var c=a[4].split(":"),c=c[0]+":"+c[1];return"HourMin"==b?c:a[2]+" "+Number(a[1])+" "+c}});g.util_DateFormat.HourMinSec=new g.util_DateFormat;g.util_DateFormat.HourMin=new g.util_DateFormat;g.util_DateFormat.DayHour=new g.util_DateFormat;
g.util_DateFormat.YearMonthDay=new g.util_DateFormat;g.util_DateFormat.YearMonth=new g.util_DateFormat;g.util_DateFormat.Year=new g.util_DateFormat;h.extendEnum(g.util_DateFormat);g.diagram_ChordGroup=function(a,b){this.endAngle=this.startAngle=this.value=0;this.index=a;this.name=b};g.diagram_Chord=function(a,b,c,e){var f,j,k,l,m,n,q,s;l=a.field(b);s=a.field(c);b=g.diagram_Hierarchical.makeByNestingFields(a,null,e,b,c);c=new h.List;e=new h.List;var y=new h.Map,A=new h.Map;a=new h.List;var x=0;b=h.iter(b.root.children);
for(f=b.current;b.hasNext();f=b.next())if(null!=f.children){f=h.iter(f.children);for(j=f.current;f.hasNext();j=f.next())if(null!=j.children){j=h.iter(j.children);for(k=j.current;j.hasNext();k=j.next())n=k.row,q=k.value,k=this.addTo(c,y,l.value(n),q),m=this.addTo(e,A,s.value(n),q),a.add(new g.diagram_ChordRibbon(k.index,m.index,n,q)),x+=q}}this.layout(c,x,2*Math.PI,Math.PI);this.layout(e,x,0,Math.PI);this.layoutChords(a,c,e,x);c.addAll(e);this.groups=c.toArray();b=h.iter(this.groups);for(l=b.current;b.hasNext();l=
b.next())l.startAngle>l.endAngle&&(s=l.startAngle,l.startAngle=l.endAngle,l.endAngle=s);this.chords=a.toArray()};g.diagram_Chord.PAD=0.1;h.copy(g.diagram_Chord,{make:function(a,b,c,e){return new g.diagram_Chord(a,b,c,e)}});h.copy(g.diagram_Chord.prototype,{layoutChords:function(a,b,c,e){var f,j,k,l,m,n,q=Math.PI*(1-g.diagram_Chord.PAD),s=h.Array(b.size(),0),y=h.Array(c.size(),0);a=h.iter(a);for(n=a.current;a.hasNext();n=a.next())j=n.source.index,m=n.target.index,f=b.get(j),l=c.get(m),k=q*n.size/e,
n.source.endAngle=f.startAngle+s[j],n.source.startAngle=n.source.endAngle-k,n.target.startAngle=l.startAngle+y[m],n.target.endAngle=n.target.startAngle+k,s[j]-=k,y[m]+=k},layout:function(a,b,c,e){var f,j=(e-c)*(1-g.diagram_Chord.PAD);e=(e-c)*g.diagram_Chord.PAD/a.size();c+=e/2;a=h.iter(a);for(f=a.current;a.hasNext();f=a.next())f.startAngle=c,f.endAngle=c+j*f.value/b,c=f.endAngle+e},addTo:function(a,b,c,e){var f=b.get(c);null==f&&(f=new g.diagram_ChordGroup(a.size(),c),b.put(c,f),a.add(f));f.value+=
e;return f}});g.diagram_Node=function(a,b,c,e){this.content=this.children=this.parent=this.key=null;this.row=a;this.value=b;this.innerNodeName=c;this.children=e};h.copy(g.diagram_Node.prototype,{meanRow:function(){var a,b,c,e;if(null!=this.children){c=e=0;a=h.iter(this.children);for(b=a.current;a.hasNext();b=a.next())e+=b.meanRow()*b.value,c+=b.value;return e/c}return this.row}});g.diagram_DAG=function(a){this.height=this.width=1;this.padding=0;this.graph=a;g.diagram_dag_NodeInfo.addInfo(a);(new g.diagram_dag_BreakCycles(a)).removeCycleEdges()};
h.copy(g.diagram_DAG.prototype,{layout:function(){var a,b,c,e,f,j=this.assignLayers();a=this.makeNodeLayers(j+1);(new g.diagram_dag_WithinLayerOrdering(a)).layout();b=0;a=h.iter(this.graph.nodes);for(c=a.current;a.hasNext();c=a.next())b=Math.max(b,Math.abs(this.info(c).pos));a=h.iter(this.graph.nodes);for(c=a.current;a.hasNext();c=a.next())e=this.padding+(this.width-2*this.padding)*(this.info(c).pos/2/b+0.5),f=this.padding+(this.height-2*this.padding)*this.info(c).layer/j,this.setNodeLocations(c,
e,f);return this},setNodeLocations:function(a,b,c){a.x=b;a.y=c;a.content=[b,c]},makeNodeLayers:function(a){var b,c,e=h.Array(a,null);for(c=0;c<a;c++)e[c]=new h.List;b=h.iter(this.graph.nodes);for(c=b.current;b.hasNext();c=b.next())e[this.info(c).layer].add(c);b=h.Array(a,null);for(c=0;c<a;c++)b[c]=e[c].toArray();return b},pad:function(a){this.padding=a;return this},size:function(a,b){this.width=a;this.height=b;return this},assignLayers:function(){var a,b,c,e,f,g,k=0;a=h.iter(this.graph.nodes);for(b=
a.current;a.hasNext();b=a.next())c=this.distanceToLeaf(b),this.info(b).layer=c,k=Math.max(k,c);a=h.iter(this.graph.nodes);for(b=a.current;a.hasNext();b=a.next())this.info(b).layer=k-this.info(b).layer;for(c=1;c<=k;c++){a=h.iter(this.graph.nodes);for(b=a.current;a.hasNext();b=a.next())if(e=this.info(b),e.layer==c)if(0<e.incoming.length){g=0;b=h.iter(e.incoming);for(f=b.current;b.hasNext();f=b.next())g=Math.max(g,this.info(f).layer);e.layer=g+1}else e.layer=0}return k},distanceToLeaf:function(a){var b,
c,e=this.info(a);if(0>e.distanceToLeaf){b=0;a=h.iter(this.info(a).outgoing);for(c=a.current;a.hasNext();c=a.next())b=Math.max(b,this.distanceToLeaf(c)+1);e.distanceToLeaf=b}return e.distanceToLeaf},info:function(a){return a.content}});g.diagram_ChordRibbon=function(a,b,c,e){this.source=new g.diagram_ChordRibbon$RibbonNode(a);this.target=new g.diagram_ChordRibbon$RibbonNode(b);this.row=c;this.size=e};g.diagram_ChordRibbon$RibbonNode=function(a){this.endAngle=this.startAngle=0;this.index=a};g.diagram_Graph=
function(a,b,c){var e,f,j,k=new h.Map,l=new h.List;for(e=0;e<a.rowCount();e++)j=a.value(e),null!=j&&(f=new g.diagram_Node(e,1,j.toString(),null),f.key=j,l.add(f),k.put(j,f));a=new h.List;for(e=0;e<b.rowCount();e++)f=k.get(b.value(e)),j=k.get(c.value(e)),null!=f&&null!=j&&a.add(new g.diagram_Edge(f,j,e));this.nodes=l.toArray();this.links=a.toArray()};h.copy(g.diagram_Graph,{make:function(a,b,c,e,f){a=a.field(b);e=c.field(e);c=c.field(f);return new g.diagram_Graph(a,e,c)}});g.diagram_dag_NodeInfo=function(a,
b){this.outgoing=this.incoming=null;this.layer=this.distanceToLeaf=-1;this.pos=0;this.incoming=a;this.outgoing=b};h.copy(g.diagram_dag_NodeInfo,{addInfo:function(a){var b,c,e,f=new h.Map,j=new h.Map;b=h.iter(a.nodes);for(c=b.current;b.hasNext();c=b.next())f.put(c,new h.Set),j.put(c,new h.Set);b=h.iter(a.links);for(c=b.current;b.hasNext();c=b.next())f.get(c.source).add(c.target),j.get(c.target).add(c.source);b=h.iter(a.nodes);for(c=b.current;b.hasNext();c=b.next())a=j.get(c),e=f.get(c),a=a.toArray(),
e=e.toArray(),c.content=new g.diagram_dag_NodeInfo(a,e)}});h.copy(g.diagram_dag_NodeInfo.prototype,{degree:function(){return this.incoming.length+this.outgoing.length}});g.diagram_dag_BreakCycles=function(a){this.graph=a;this.safe=new h.Set};h.copy(g.diagram_dag_BreakCycles.prototype,{removeCycleEdges:function(){var a,b;a=h.iter(this.graph.nodes);for(b=a.current;a.hasNext();b=a.next())this.searchForCycles(null,b,new h.Set)},searchForCycles:function(a,b,c){var e;if(!this.safe.contains(b))if(c.contains(b))this.removeEdgeInfo(a,
b);else{c.add(b);a=h.iter(b.content.outgoing);for(e=a.current;a.hasNext();e=a.next())this.searchForCycles(b,e,c);this.safe.add(b);c.remove(b)}},removeEdgeInfo:function(a,b){var c=a.content,e=b.content;c.outgoing=this.removeFromArray(c.outgoing,b);e.incoming=this.removeFromArray(e.incoming,a)},removeFromArray:function(a,b){var c,e,f=h.Array(a.length-1,null),g=0;c=h.iter(a);for(e=c.current;c.hasNext();e=c.next())e!=b&&(f[g++]=e);return f}});g.diagram_dag_WithinLayerOrdering=function(a){var b,c;this.layers=
a;c=0;a=h.iter(a);for(b=a.current;a.hasNext();b=a.next())c=Math.max(c,b.length);this.maxMaxLayerCount=c};g.diagram_dag_WithinLayerOrdering.EPSILON=1E-6;h.copy(g.diagram_dag_WithinLayerOrdering.prototype,{layout:function(){var a;this.makeInitialPlacement();for(a=0;3>a;a++)this.alignChildren(),this.alignParents();this.alignChildren()},alignChildren:function(){var a,b,c,e;for(b=1;b<this.layers.length;b++){e=this.layers[b];a=h.iter(e);for(c=a.current;a.hasNext();c=a.next())c=this.info(c),c.pos=(this.averagePos(c.incoming)+
c.pos*g.diagram_dag_WithinLayerOrdering.EPSILON)/(1+g.diagram_dag_WithinLayerOrdering.EPSILON);this.distributeLayer(e)}},alignParents:function(){var a,b,c,e;for(b=this.layers.length-2;0<=b;b--){e=this.layers[b];a=h.iter(e);for(c=a.current;a.hasNext();c=a.next())c=this.info(c),c.pos=(this.averagePos(c.outgoing)+c.pos*g.diagram_dag_WithinLayerOrdering.EPSILON)/(1+g.diagram_dag_WithinLayerOrdering.EPSILON);this.distributeLayer(e)}},averagePos:function(a){var b,c,e;if(0==a.length)return 0;e=0;b=h.iter(a);
for(c=b.current;b.hasNext();c=b.next())e+=this.info(c).pos;return e/a.length},makeInitialPlacement:function(){var a,b,c,e,f,g,k;a=h.iter(this.layers);for(f=a.current;a.hasNext();f=a.next()){for(e=0;e<f.length;e++){b=f[e];g=this.info(b);c=g.degree()+1E-6*e;b=h.iter(g.incoming);for(k=b.current;b.hasNext();k=b.next())c+=0.1*this.info(k).degree();b=h.iter(g.outgoing);for(k=b.current;b.hasNext();k=b.next())c+=0.1*this.info(k).degree();g.pos=c}this.distributeLayer(f)}},distributeLayer:function(a){var b,
c,e,f,g=a.length;if(1==g)this.info(a[0]).pos=0;else{this.sortLayers(a);for(b=0;b<g;b++)c=this.info(a[b]),e=b-(g-1)/2,f=this.maxMaxLayerCount*e/(g-1),c.pos=(e+f)/2}},sortLayers:function(a){a.sort(function(a,c){return a.content.pos<c.content.pos?-1:1})},info:function(a){return a.content}});g.diagram_Hierarchical=function(){this.links=this.root=null};h.copy(g.diagram_Hierarchical,{makeByNestingFields:function(a,b,c){var e=Array.prototype.slice.call(arguments,3),f=new g.diagram_Hierarchical,h=null==c?
null:a.field(c),k=null==b?null:a.field(b),e=g.diagram_Hierarchical.toFields(a,e);f.makeNodesUsingFields(a,k,h,e);f.fixChildren();return f},makeByEdges:function(a,b,c,e,f,h){var k=new g.diagram_Hierarchical;b=a.field(b);f=e.field(f);e=e.field(h);a=null==c?null:a.field(c);k.makeNodesUsingEdges(b,a,f,e);k.fixChildren();return k},compare:function(a,b){var c=g.Data.compare(a.meanRow(),b.meanRow());return 0!=c?c:g.Data.compare(a.key,b.key)},compareReverse:function(a,b){return g.diagram_Hierarchical.compare(b,
a)},makeInternalNode:function(a){a=new g.diagram_Node(null,0,a,new h.List);a.content=new h.Map;return a},toFields:function(a,b){var c,e=h.Array(b.length,null);for(c=0;c<e.length;c++)e[c]=a.field(b[c]);return e}});h.copy(g.diagram_Hierarchical.prototype,{find:function(a){return this.findNamedNode(this.root,a)},findNamedNode:function(a,b){var c,e;if(h.equals(b,a.key))return a;if(null==a.children)return null;c=h.iter(a.children);for(e=c.current;c.hasNext();e=c.next())if(e=this.findNamedNode(e,b),null!=
e)return e;return null},fixChildren:function(){this.replaceCollections(this.root,null,new h.Set)},makeNodesUsingFields:function(a,b,c,e){var f,j,k,l,m,n,q,s;this.root=g.diagram_Hierarchical.makeInternalNode("");for(q=0;q<a.rowCount();q++)if(l=null==c?1:g.Data.asNumeric(c.value(q)),0<l){k=this.root;f=h.iter(e);for(m=f.current;f.hasNext();m=f.next())n=k.content,j=k.children,s=m.value(q),null!=s&&(k=n.get(s)),null==k&&(k=g.diagram_Hierarchical.makeInternalNode(m.valueFormatted(q)),j.add(k),n.put(s,k));
f=new g.diagram_Node(q,l,null,null);null!=b&&(f.key=b.value(q));k.children.add(f);f.parent=k}},makeNodesUsingEdges:function(a,b,c,e){var f,j,k,l;l=a.rowCount();var m=new h.Set,n=new h.List,q=new h.Map;for(k=0;k<l;k++)f=a.value(k),j=null==b?1:g.Data.asNumeric(b.value(k)),j=new g.diagram_Node(k,j,null,new h.List),j.key=f,m.add(j),n.add(j),q.put(f,j);l=new h.List;a=c.rowCount();for(k=0;k<a;k++)b=q.get(c.value(k)),f=q.get(e.value(k)),null!=b&&(null!=f&&m.contains(f))&&(b.children.add(f),m.remove(f),l.add(new g.diagram_Edge(b,
f,k)));this.links=l.toArray();if(1==m.size())this.root=(new h.List(m)).get(0);else{this.root=g.diagram_Hierarchical.makeInternalNode("");c=h.iter(n);for(e=c.current;c.hasNext();e=c.next())m.contains(e)&&this.root.children.add(e)}},replaceCollections:function(a,b,c){var e;if(c.add(a)&&(a.content=null,e=a.children,null!=e)){a.children=h.isEmpty(e)?null:e.toArray();null==a.key&&(a.key=null==b?a.innerNodeName:b+"|"+a.innerNodeName);b=h.iter(e);for(e=b.current;b.hasNext();e=b.next())this.replaceCollections(e,
a.key,c)}}});g.diagram_Edge=function(a,b,c){this.row=c;this.source=a;this.target=b;this.key=a.key+"--"+b.key};g.auto_NumericExtentDetail=function(a,b,c,e,f,g,h,l){this.low=a;this.high=b;this.dateUnit=c;this.includeZeroDesired=e;this.transform=f;this.granularity=g;this.preferCategorical=h;this.optimalBinCount=l};h.copy(g.auto_NumericExtentDetail,{makeForField:function(a){var b;return a.isNumeric()&&null!=a.min()?(b="#count"==a.name||"sum"==a.strProperty("summary"),new g.auto_NumericExtentDetail(a.min(),
a.max(),a.property("dateUnit"),b,g.auto_Auto.defineTransform(a),a.numProperty("granularity"),a.preferCategorical(),g.auto_Auto.optimalBinCount(a))):null}});h.copy(g.auto_NumericExtentDetail.prototype,{range:function(){return this.high-this.low},merge:function(a){var b;if(null==a||this.dateUnit!=a.dateUnit)return null;b=h.len(a.transform)<h.len(this.transform)?this.transform:a.transform;return new g.auto_NumericExtentDetail(Math.min(this.low,a.low),Math.max(this.high,a.high),this.dateUnit,this.includeZeroDesired||
a.includeZeroDesired,b,Math.min(this.granularity,a.granularity),this.preferCategorical&&a.preferCategorical,Math.max(this.optimalBinCount,a.optimalBinCount))},content:function(){return null==this.dateUnit?[this.low,this.high]:[g.Data.asDate(this.low),g.Data.asDate(this.high)]}});g.auto_Auto=function(){};g.auto_Auto.FRACTION_TO_CONVERT=0.5;h.copy(g.auto_Auto,{makeNumericScale:function(a,b,c,e,f,h){var k;1>f&&(f=Math.min(a.optimalBinCount,20)+1);if(null!=a.dateUnit)return g.auto_NumericScale.makeDateScale(a,
b,c,f);if("log"==a.transform)return g.auto_NumericScale.makeLogScale(a,b,c,e,f);"root"==a.transform&&0<a.low&&(k=a.low/a.high/(Math.sqrt(a.low)/Math.sqrt(a.high)),e*=k,c[0]*=k);return g.auto_NumericScale.makeLinearScale(a,b,e,c,f,h)},defineTransform:function(a){var b=a.strProperty("transform");null==b&&(b=g.auto_Auto.transformForSkew(a.numProperty("skew"),a.min(),a.max()),a.set("transform",b));return b},transformForSkew:function(a,b,c){return null==a?"linear":2<a&&0<b&&c>75*b?"log":1<a&&0<=b?"root":
"linear"},optimalBinCount:function(a){var b,c;c=a.numProperty("stddev");if(null==c)return 2;b=2*(a.numProperty("q3")-a.numProperty("q1"))/Math.pow(a.valid(),0.33333);c=3.5*c/Math.pow(a.valid(),0.33333);b=Math.max(b,c);return 0==b?2:Math.max(2,Math.round((a.max()-a.min())/b+0.499))},convert:function(a){var b,c,e,f,j,k;if(a.isSynthetic()||a.isDate()||a.isProperty("list"))return a;b=g.Data.toList(a);if(g.auto_Auto.goodLists(b))return b;b=a.valid();k=h.Array(a.rowCount(),0);for(c=0;c<k.length;c++)k[c]=
c;for(c=0;c<k.length;c++)e=Math.floor(Math.random()*(k.length-c)),j=k[c],k[c]=k[e],k[e]=j;if(a.isNumeric())c=a;else{for(f=c=e=0;e<b&&50>e;)j=a.value(k[c++]),null!=j&&(e++,!(j instanceof Date)&&null!=g.Data.asNumeric(j)&&f++);c=f>g.auto_Auto.FRACTION_TO_CONVERT*e?g.Data.toNumeric(a):null}if(null!=c)return g.auto_Auto.isYearly(c)?g.Data.toDate(c,"year"):c;for(f=c=e=0;e<b&&50>e;)j=a.value(k[c++]),null!=j&&(e++,null!=g.Data.asDate(j)&&f++);return f>g.auto_Auto.FRACTION_TO_CONVERT*e?g.Data.toDate(a):a},
goodLists:function(a){var b,c,e,f=a.valid();if(3>f)return!1;c=-1;for(b=1;b<a.rowCount();b++)if(e=a.value(b),null!=e)if(0>c)c=e.size();else if(e.size()!=c){if(20>f)return!0;a=a.property("listCategories").length;return a*a<2*f}return!1},isYearly:function(a){if(1600>a.numProperty("q1")||2100<a.numProperty("q3"))return!1;a=a.numProperty("granularity");return null!=a&&0<a&&1E-6>a-Math.floor(a)}});g.auto_DomainSpan=function(a,b,c,e){this.index=a;this.preferContinuous=b;this.categories=c;this.numeric=e};
h.copy(g.auto_DomainSpan,{make:function(a,b,c){var e=a.preferCategorical()?a.categories():null;a=g.auto_NumericExtentDetail.makeForField(a);return null==a&&null==e?null:new g.auto_DomainSpan(b,c,e,a)}});h.copy(g.auto_DomainSpan.prototype,{compareTo:function(a){var b=this.typeScore()-a.typeScore();if(0!=b)return b;try{if(null==this.categories)return g.Data.compare(this.numeric.low,a.numeric.low)}catch(c){c.printStackTrace()}return this.index-a.index},desiresZero:function(){return null!=this.numeric&&
this.numeric.includeZeroDesired},isNumeric:function(){return null==this.categories||null!=this.numeric&&this.preferContinuous},typeScore:function(){return null==this.numeric?5:(null!=this.numeric.dateUnit?1:3)+(null==this.categories?0:1)},content:function(){return null==this.categories||this.preferContinuous&&null!=this.numeric?this.numeric.content():this.categories},merge:function(a){var b=this.mergeCategories(this.categories,a.categories),c=null==this.numeric?null:this.numeric.merge(a.numeric);
return null==b&&null==c?null:new g.auto_DomainSpan(Math.min(this.index,a.index),this.preferContinuous&&a.preferContinuous,b,c)},isDate:function(){return null!=this.numeric&&null!=this.numeric.dateUnit},mergeCategories:function(a,b){var c,e,f,g;if(null==a||null==b)return null;e=new h.Set;h.addAll(e,a);g=new h.List;h.addAll(g,a);c=h.iter(b);for(f=c.current;c.hasNext();f=c.next())e.contains(f)||g.add(f);return g.toArray()},relativeSize:function(){return null==this.categories?1:Math.min(this.categories.length,
8)/8}});g.auto_NumericScale=function(a,b,c,e,f){this.type=a;this.min=b;this.max=c;this.divisions=e;this.granular=f};g.auto_NumericScale.HALF_LOG=3;h.copy(g.auto_NumericScale,{makeDateScale:function(a,b,c,e){var f,j,k=a.low,l=a.high;k==l?(k=g.Data.asNumeric(g.util_DateUnit.increment(g.Data.asDate(k),a.dateUnit,-1)),l=g.Data.asNumeric(g.util_DateUnit.increment(g.Data.asDate(l),a.dateUnit,1))):(k-=c[0]*(l-k),l+=c[1]*(l-k));c=(l-k)/(e-1);a=g.stats_DateStats.getUnit(4*c);e=g.auto_NumericScale.bestDateMultiple(a,
c);j=g.util_DateUnit.floor(g.Data.asDate(k),a,e);b&&(k=g.Data.asNumeric(j));for(c=new h.List;;){f=g.Data.asNumeric(j);if(f>=l){if(b||f==l)l=f,c.add(f);break}f>=k&&c.add(f);j=g.util_DateUnit.increment(j,a,e)}b&&(l=g.Data.asNumeric(j));b=c.toArray();return new g.auto_NumericScale("date",k,l,b,!1)},bestDateMultiple:function(a,b){var c,e=b/a.approxDaysPerUnit,f=1;for(c=2;c<=a.base/2;c++)0==a.base%c&&4!=c&&(6==c&&60==a.base||Math.abs(e-c)<=Math.abs(e-f)&&(f=c));return f},makeLinearScale:function(a,b,c,
e,f,j){var k,l,m,n,q,s;if(null==a)return new g.auto_NumericScale("linear",0,1,[0,1],!1);l=a.low-e[0]*a.range();e=a.high+e[1]*a.range();0<l&&l/e<=c&&(l=0);0>e&&e/l<=c&&(e=0);0==l&&(1.0001>=a.high&&1<e&&(e=1),100.001>a.high&&100<e&&(e=100));l+1E-9>e&&(e=Math.max(0,2*l),l=Math.min(0,2*l),0==l&&0==e&&(l=0,e=1));k=Math.max(f-1,1);c=a.transform;n=a.granularity;m=(e-l)/n;if((j||a.preferCategorical)&&m>k/2&&m<2*k)return b=g.auto_NumericScale.makeGranularDivisions(l,e,n,b),new g.auto_NumericScale(c,l,e,b,
!0);a=Math.floor(Math.log((e-l)/k)/Math.log(10));j=Math.pow(10,a);m=1E9;k=h.iter([j,10*j,j/10,5*j,j/2,2*j,j/5]);for(a=k.current;k.hasNext();a=k.next())s=a*Math.ceil(l/a),q=a*Math.floor(e/a),n=Math.round((q-s)/a)+1,b&&l<s&&n++,b&&e>q&&n++,q=Math.abs(n-f),n>f&&(q-=0.001),q<m&&(m=q,j=a);f=j*Math.floor(l/j);b&&(l=f,e=j*Math.ceil(e/j));f<l-1E-6&&(f+=j);for(a=new h.List;f<e+1E-6;)a.add(f),f+=j;b=a.toArray();return new g.auto_NumericScale(c,l,e,b,!1)},makeGranularDivisions:function(a,b,c,e){var f=new h.List;
e||(a+=c,b-=c);for(a-=c/2;a<b+c;)f.add(a),a+=c;return f.toArray()},makeLogScale:function(a,b,c,e,f){var j,k;k=Math.log(a.low)/Math.log(10);j=Math.log(a.high)/Math.log(10);c=Math.max(c[0],c[1]);k-=c*(j-k);j+=c*(j-k);0.5<e&&0==k&&(k=-0.5);0<k&&k/j<=e&&(k=0);b&&(k=Math.floor(k),j=Math.ceil(j));e=j-k+1;b=e<0.666*f;c=e>1.66*f?100:10;e=new h.List;f=Math.pow(10,k);j=Math.pow(10,j);b&&j/2>a.high&&(j/=2);k=Math.pow(10,Math.ceil(k));for(a=1.001*j;k<a;)e.add(k),b&&k*g.auto_NumericScale.HALF_LOG<a&&e.add(k*g.auto_NumericScale.HALF_LOG),
k*=c;a=e.toArray();return new g.auto_NumericScale("log",f,j,a,!1)}});g.auto_Domain=function(a){this.mergedRanges=this.merged=null;this.preferContinuous=a;this.raw=new h.List};h.copy(g.auto_Domain.prototype,{include:function(a){a=g.auto_DomainSpan.make(a,this.raw.size(),this.preferContinuous);null!=a&&this.raw.add(a);this.merged=null;return this},range:function(a){this.make();return this.mergedRanges[a]},spanCount:function(){return this.make().size()},span:function(a){return this.make().get(a)},make:function(){null==
this.merged&&(this.makeDomains(),this.makeRanges());return this.merged},makeDomains:function(){var a,b,c,e;h.sort(this.raw);this.merged=new h.List;b=null;a=h.iter(this.raw);for(e=a.current;a.hasNext();e=a.next())null==b?b=e:(c=b.merge(e),null==c?(this.merged.add(b),b=e):b=c);null!=b&&this.merged.add(b)},makeRanges:function(){var a,b,c,e;this.mergedRanges=h.Array(this.merged.size(),0);e=0.1*(this.merged.size()-1);a=h.iter(this.merged);for(b=a.current;a.hasNext();b=a.next())e+=b.relativeSize();for(b=
a=0;b<this.mergedRanges.length;b++)c=this.merged.get(b).relativeSize(),this.mergedRanges[b]=[a/e,(a+c)/e],a+=c+0.1}});g.io_ByteOutput=function(){this.out=[]};h.copy(g.io_ByteOutput.prototype,{addByte:function(a){this.out.push(a);return this},addNumber:function(a){var b;if(null==a)return this.addByte(255),this;b=Math.floor(a);if(b==a&&0<=b&&65536>b){if(252>=b)return this.addByte(b);this.addByte(253);this.addByte(b&255);this.addByte(b>>8&255);return this}this.addByte(254);this.addDouble(a);return this},
addDouble:function(a){isNaN(a)?this.addString("NaN"):this.addString(this.stringify(a))},stringify:function(a){return a.toString()},addDate:function(a){this.addNumber(g.Data.asNumeric(a))},addString:function(a){if(null==a)return this.addByte(3);for(var b=0;b<a.length;b++){var c=a.charCodeAt(b);128>c?this.addByte(c):2048>c?this.addByte(c>>6|192).addByte(c&63|128):this.addByte(c>>12|224).addByte(c>>6&63|128).addByte(c&63|128)}return this.addByte(0)},asBytes:function(){return this.out}});g.io_ByteInput=
function(a){this.p=0;this.data=a;this.p=0};h.copy(g.io_ByteInput.prototype,{readNumber:function(){var a,b;a=this.readByte()&255;if(252>=a)return a;if(253==a)return a=this.readByte()&255,b=this.readByte()&255,a+256*b;if(254==a)return this.readDouble();if(255==a)return null;throw new h.Exception("Serializing "+a);},readDate:function(){return g.Data.asDate(this.readNumber())},readDouble:function(){var a=this.readString();return"NaN"==a?Number.NaN:g.Data.parseDouble(a)},readString:function(){for(var a,
b,c="";;){a=this.readByte();if(3==a&&""==c)return null;if(0==a)return c;b=a>>4;if(8>b)c+=String.fromCharCode(a);else if(12==b||13==b)c+=String.fromCharCode((a&31)<<6|this.readByte()&63);else if(14==b){b=this.readByte();var e=this.readByte(),c=c+String.fromCharCode((a&15)<<12|(b&63)<<6|e&63)}}},readByte:function(){return this.data[this.p++]}});g.io_Serialize=function(){};g.io_Serialize.DATA_SET=1;g.io_Serialize.FIELD=2;g.io_Serialize.NUMBER=3;g.io_Serialize.STRING=4;g.io_Serialize.DATE=5;g.io_Serialize.VERSION=
6;g.io_Serialize.DATASET_VERSION_NUMBER=1;h.copy(g.io_Serialize,{serializeDataset:function(a){var b,c;a=a.removeSpecialFields();c=new g.io_ByteOutput;c.addByte(g.io_Serialize.VERSION).addNumber(g.io_Serialize.DATASET_VERSION_NUMBER);c.addByte(g.io_Serialize.DATA_SET).addNumber(a.fields.length);a=h.iter(a.fields);for(b=a.current;a.hasNext();b=a.next())g.io_Serialize.addFieldToOutput(b,c);return c.asBytes()},serializeField:function(a){var b=new g.io_ByteOutput;g.io_Serialize.addFieldToOutput(a,b);return b.asBytes()},
addFieldToOutput:function(a,b){var c,e,f,j,k=a.rowCount();b.addByte(g.io_Serialize.FIELD).addString(a.name).addString(a.label);e=new h.Map;f=new h.List;for(c=0;c<k;c++)j=a.value(c),e.containsKey(j)||(e.put(j,e.size()),f.add(j));b.addNumber(f.size());if(a.isDate()){b.addByte(g.io_Serialize.DATE);c=h.iter(f);for(f=c.current;c.hasNext();f=c.next())b.addDate(f)}else if(a.isNumeric()){b.addByte(g.io_Serialize.NUMBER);c=h.iter(f);for(f=c.current;c.hasNext();f=c.next())b.addNumber(f)}else{b.addByte(g.io_Serialize.STRING);
c=h.iter(f);for(f=c.current;c.hasNext();f=c.next())b.addString(f)}b.addNumber(k);for(c=0;c<k;c++)b.addNumber(e.get(a.value(c)))},deserialize:function(a){a=new g.io_ByteInput(a);return g.io_Serialize.readFromByteInput(a)},readFromByteInput:function(a){var b,c,e,f,j,k,l;b=a.readByte();if(b==g.io_Serialize.FIELD){l=a.readString();j=a.readString();k=a.readNumber();b=a.readByte();f=h.Array(k,null);for(c=0;c<k;c++)if(b==g.io_Serialize.NUMBER)f[c]=a.readNumber();else if(b==g.io_Serialize.STRING)f[c]=a.readString();
else if(b==g.io_Serialize.DATE)f[c]=a.readDate();else throw new h.Exception("Unknown column type "+b);k=a.readNumber();e=h.Array(k,0);for(c=0;c<k;c++)e[c]=a.readNumber();a=g.Fields.permute(g.Fields.makeColumnField(l,j,f),e,!1);(b==g.io_Serialize.NUMBER||b==g.io_Serialize.DATE)&&a.setNumeric();b==g.io_Serialize.DATE&&a.set("date",!0);return a}if(b==g.io_Serialize.DATA_SET){k=a.readNumber();b=h.Array(k,null);for(c=0;c<k;c++)b[c]=g.io_Serialize.readFromByteInput(a);return g.Dataset.make(b,!1)}if(b==
g.io_Serialize.VERSION){c=a.readNumber();if(c!=g.io_Serialize.DATASET_VERSION_NUMBER)throw new h.Exception("Serialized version differs from current execution version");return g.io_Serialize.readFromByteInput(a)}throw new h.Exception("Unknown class: "+b);}});g.io_CSV=function(){};h.copy(g.io_CSV,{read:function(a){a=g.io_CSV.parse(a);return g.io_CSV.makeFields(a)},parse:function(a){var b,c;c=new h.Map;for(var e=new h.List,f=new h.List,j=" ",k=!1,l=!1,m=0,n=g.io_CSV.findSeparator(a),q=null,s=-1;m<=h.len(a);){b=
m==h.len(a)?"\n":a.charAt(m);if(k)'"'==b?m<h.len(a)-1&&'"'==a.charAt(m+1)?(q+='"',m++):k=!1:q+=b;else if("\n"==b||"\r"==b){if("\r"!=j||"\n"!=b){if(h.isEmpty(f)&&(null==q||0==h.len(q.trim())))break;f.add(g.io_CSV.saveMemory(q,c,l));e.add(f);if(0>s)s=f.size();else if(s!=f.size())throw new h.Exception("Line "+e.size()+" had "+f.size()+" entries; expected "+s);f=new h.List;q=null;l=!1}}else'"'==b?(l=k=!0,null==q&&(q="")):b==n?(f.add(g.io_CSV.saveMemory(q,c,l)),q=null,l=!1):(null==q&&(q=""),q+=b);j=b;
m++}b=h.Array(e.size(),null);for(a=0;a<b.length;a++)c=e.get(a),b[a]=c.toArray();return b},findSeparator:function(a){var b,c,e,f,g,k,l=[",","\t","|",";"],m=",",n=-1E5,q=Math.min(5E3,h.len(a));for(c=0;4>c;c++){k=l[c];b=[0,0];for(e=f=0;e<q&&2>f;e++)g=a.charAt(e),g==k&&b[f]++,"\n"==g&&f++;e=b[0];if(b[0]!=b[1]||0==b[0])e-=1E4;e>n&&(m=k,n=e)}return m},saveMemory:function(a,b,c){if(null==a||!c&&(a=a.trim(),h.isEmpty(a)))return null;c=b.get(a);return null==c?(b.put(a,a),a):c},makeFields:function(a){var b,
c,e,f=h.Array(a[0].length,null);for(c=0;c<f.length;c++){b=h.Array(a.length-1,null);for(e=0;e<b.length;e++)b[e]=a[e+1][c];e=null==a[0][c]?"":a[0][c].toString();f[c]=g.Fields.makeColumnField(g.io_CSV.identifier(e),g.io_CSV.readable(e),b)}return f},identifier:function(a){var b,c,e,f;c=a.indexOf("(");0<c&&(a=a.substring(0,c).trim());f="";e="X";for(c=0;c<h.len(a);c++)b=a.substring(c,c+1),g.io_CSV.isDigit(b)?0==c&&(f="_"):"_"==b||g.io_CSV.isLower(b)||g.io_CSV.isUpper(b)?"_"==f&&(f=""):b="_","_"==b?"_"!=
e&&(f+=b):f+=b,e=b;return 0==h.len(f)?"_":f},readable:function(a){var b,c,e,f,j="",k=" ",l=!1;for(b=0;b<h.len(a);b++)e=a.substring(b,b+1),"_"==e&&(e=" "),c=g.io_CSV.isLower(e),f=g.io_CSV.isUpper(e)," "==e?" "!=k&&(j+=e):j=c?" "==k?j+e.toUpperCase():j+e:l&&(f||g.io_CSV.isDigit(e))?j+(" "+e):j+e,l=c,k=e;return j},isDigit:function(a){return 0<="0123456789".indexOf(a)},isLower:function(a){return 0<="abcdefghijklmnopqrstuvwxyz".indexOf(a)},isUpper:function(a){return 0<="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(a)}});
g.values_ReorderedProvider=function(a,b){var c;if(a instanceof g.values_ReorderedProvider){this.base=a.base;this.order=h.Array(b.length,0);for(c=0;c<b.length;c++)this.order[c]=a.order[b[c]]}else this.base=a,this.order=b};h.copy(g.values_ReorderedProvider.prototype,{compareRows:function(a,b,c){return this.base.compareRows(this.order[a],this.order[b],c)},count:function(){return this.order.length},expectedSize:function(){return 24+4*this.order.length+this.base.expectedSize()},setValue:function(a,b){return g.values_ColumnProvider.copy(this).setValue(a,
b)},value:function(a){return this.base.value(this.order[a])}});g.values_ColumnProvider=function(a){var b,c,e,f=new h.Map;this.column=h.Array(a.length,null);for(b=0;b<a.length;b++)e=a[b],c=f.get(e),null==c?(f.put(e,e),this.column[b]=e):this.column[b]=c};h.copy(g.values_ColumnProvider,{copy:function(a){var b,c=h.Array(a.count(),null);for(b=0;b<c.length;b++)c[b]=a.value(b);return new g.values_ColumnProvider(c)}});h.copy(g.values_ColumnProvider.prototype,{count:function(){return this.column.length},expectedSize:function(){var a,
b,c=new h.Set,e=24+4*this.column.length;a=h.iter(this.column);for(b=a.current;a.hasNext();b=a.next())null!=b&&c.add(b)&&(e=b instanceof String?e+(42+2*h.len(b)):e+16);return e},setValue:function(a,b){this.column[b]=a;return this},compareRows:function(a,b,c){a=this.column[a];b=this.column[b];return a==b?0:null==a?1:null==b?-1:h.isEmpty(c)?g.Data.compare(a,b):c.get(a)-c.get(b)},value:function(a){return this.column[a]}});g.values_ConstantProvider=function(a,b){this.o=a;this.len=b};h.copy(g.values_ConstantProvider.prototype,
{compareRows:function(){return 0},count:function(){return this.len},expectedSize:function(){return 24},setValue:function(a,b){return g.values_ColumnProvider.copy(this).setValue(a,b)},value:function(){return this.o}});g.values_RowProvider=function(a){this.len=a};h.copy(g.values_RowProvider.prototype,{count:function(){return this.len},expectedSize:function(){return 24},setValue:function(a,b){return g.values_ColumnProvider.copy(this).setValue(a,b)},value:function(a){return a+1},compareRows:function(a,
b){return a-b}});g.modify_DataOperation=function(){};h.copy(g.modify_DataOperation,{map:function(a){var b,c=new h.List;a=h.iter(g.modify_DataOperation.strings(a,";"));for(b=a.current;a.hasNext();b=a.next())c.add(g.modify_DataOperation.strings(b,"="));return c},strings:function(a,b){var c,e=g.Data.split(a,b);for(c=0;c<e.length;c++)e[c]=e[c].trim();return 1==e.length&&h.isEmpty(e[0])?h.Array(0,null):e}});g.modify_Each=function(){h.superconstruct(this)};h.extend(g.modify_Each,g.modify_DataOperation);
h.copy(g.modify_Each,{transform:function(a,b){var c,e;c=h.iter(g.modify_DataOperation.strings(b,";"));for(e=c.current;c.hasNext();e=c.next())e=a.field(e),e.isProperty("list")&&(a=g.modify_Each.splitListsInField(a,e));return a},splitListsInField:function(a,b){var c,e,f,j,k;j=new h.List;var l=new h.List;for(f=0;f<b.rowCount();f++)if(e=b.value(f),null==e)l.add(),j.add(f);else for(c=0;c<e.size();c++)l.add(e.get(c)),j.add(f);j=g.Data.toPrimitive(j.toArray());k=h.Array(a.fields.length,null);for(f=0;f<k.length;f++)e=
a.fields[f],e==b?(c=l.toArray(),k[f]=g.Fields.makeColumnField(e.name,e.label,c)):k[f]=g.Fields.permute(e,j,!1);return a.replaceFields(k)}});g.modify_AllCombinations=function(a,b,c){this.fields=a;this.xCount=b;this.keyLength=b+c;this.index=h.Array(this.keyLength,0);this.categories=this.makeFieldCategories()};h.copy(g.modify_AllCombinations.prototype,{makeFieldCategories:function(){var a,b,c,e=h.Array(this.keyLength,null);for(a=0;a<this.keyLength;a++)if(c=this.fields[a].categories(),a<this.xCount)e[a]=
c;else if(a>=this.xCount){e[a]=h.Array(c.length,null);for(b=0;b<c.length;b++)e[a][b]=c[c.length-1-b]}return e},make:function(){for(var a,b,c=g.modify_Stack.makeStackDataOrder(this.fields,this.keyLength,this.xCount),e=0,f=new h.List;;){b=this.makeKeyRow();for(a=!1;this.matchesCurrent(b,c,e);)a=!0,f.add(this.makeRealRow(c[e++]));a||f.add(b);if(!this.nextIndex())break}a=h.Array(this.fields.length,null);for(b=0;b<this.fields.length;b++)a[b]=g.Fields.makeColumnField(this.fields[b].name,this.fields[b].label,
this.extractColumn(f,b)),g.Fields.copyBaseProperties(this.fields[b],a[b]);return a},extractColumn:function(a,b){var c,e=h.Array(a.size(),null);for(c=0;c<e.length;c++)e[c]=a.get(c)[b];return e},makeKeyRow:function(){var a,b=h.Array(this.fields.length,null);for(a=0;a<this.keyLength;a++)b[a]=this.categories[a][this.index[a]];return b},makeRealRow:function(a){var b,c=h.Array(this.fields.length,null);for(b=0;b<this.fields.length;b++)c[b]=this.fields[b].value(a);return c},matchesCurrent:function(a,b,c){if(c>=
b.length)return!1;b=b[c];for(c=0;c<this.keyLength;c++)if(0!=g.Data.compare(a[c],this.fields[c].value(b)))return!1;return!0},nextIndex:function(){var a;for(a=this.index.length-1;0<=a;a--){if(++this.index[a]<this.categories[a].length)return!0;this.index[a]=0}return!1}});g.modify_Sort=function(){h.superconstruct(this)};h.extend(g.modify_Sort,g.modify_DataOperation);h.copy(g.modify_Sort,{transform:function(a,b,c){var e,f,j,k,l;e=g.modify_DataOperation.strings(b,";");if(0==e.length)return a;b=g.modify_Sort.getFields(a,
e);e=g.modify_Sort.getAscending(b,e);l=(new g.summary_FieldRowComparison(b,e,!0)).makeSortedOrder();for(k=a.fields.length-1;0<=k;k--)f=a.fields[k],f.isBinned()&&f.preferCategorical()&&(l=g.modify_Sort.moveCatchAllToEnd(l,f));f=h.Array(a.fields.length,null);for(k=0;k<f.length;k++)j=a.fields[k],f[k]=g.Fields.permute(j,l,!0),!j.ordered()&&c&&(j=g.modify_Sort.makeOrder(j,b,e),f[k].setCategories(j));return a.replaceFields(f)},makeOrder:function(a,b,c){var e,f,j,k,l,m=new h.Map;for(j=0;j<a.rowCount();j++)e=
a.value(j),null!=e&&(l=m.get(e),null==l&&(l=new h.List,m.put(e,l)),l.add(j));a=a.categories();e=a.length;f=h.Array(b.length,e,null);for(k=0;k<e;k++){l=m.get(a[k]);for(j=0;j<b.length;j++)f[j][k]=b[j].isNumeric()?g.modify_Sort.sum(b[j],l):g.modify_Sort.mode(b[j],l)}l=h.Array(b.length,null);for(j=0;j<b.length;j++)l[j]=g.Fields.makeColumnField("",null,f[j]),b[j].isNumeric()&&l[j].setNumeric();b=(new g.summary_FieldRowComparison(l,c,!0)).makeSortedOrder();c=h.Array(e,null);for(j=0;j<e;j++)c[j]=a[b[j]];
return c},sum:function(a,b){var c,e,f=0;c=h.iter(b);for(e=c.current;c.hasNext();e=c.next())e=g.Data.asNumeric(a.value(e)),null!=e&&(f+=e);return f},mode:function(a,b){var c,e,f=new g.util_MapInt;c=h.iter(b);for(e=c.current;c.hasNext();e=c.next())f.increment(a.value(e));return f.mode()},makeRowRanking:function(a,b){for(var c,e,f=h.Array(a.length,0),g=0;g<a.length;){for(c=g+1;c<a.length&&0==b.compare(a[g],a[c]);)c++;for(e=(c+g+1)/2;g<c;)f[a[g++]]=e}return f},getFields:function(a,b){var c,e,f=h.Array(b.length,
null);for(c=0;c<f.length;c++)if(e=b[c].split(":")[0],f[c]=a.field(e.trim()),null==f[c])throw new h.Exception("Could not find field: "+e);return f},getAscending:function(a,b){var c,e,f=h.Array(a.length,!1);for(c=0;c<f.length;c++)if(e=b[c].split(":"),1<e.length)if(e=e[1].trim(),h.equalsIgnoreCase(e,"ascending"))f[c]=!0;else if(h.equalsIgnoreCase(e,"descending"))f[c]=!1;else throw new h.Exception("Sort options must be 'ascending' or 'descending'");else f[c]=a[c].isDate()||!a[c].isNumeric();return f},
moveCatchAllToEnd:function(a,b){var c,e,f=h.Array(a.length,0),g=new h.List,k=0;c=h.iter(a);for(e=c.current;c.hasNext();e=c.next())"…"==b.value(e)?g.add(e):f[k++]=e;c=h.iter(g);for(e=c.current;c.hasNext();e=c.next())f[k++]=e;return f},categoriesFromRanks:function(a,b){var c,e,f,j;j=a.rowCount();var k=a.categories(),l=a.property("categoryCounts"),m=h.Array(l.length,0);for(e=0;e<m.length;e++)m[e]=e/100/m.length;c=(new g.util_MapInt).index(k);for(e=0;e<j;e++)f=a.value(e),null!=f&&(f=c.get(f),m[f]+=b[e]/
l[f]);j=g.Data.order(m,!0);c=h.Array(j.length,null);for(e=0;e<j.length;e++)c[e]=k[j[e]];return c}});g.modify_Transform=function(){h.superconstruct(this)};h.extend(g.modify_Transform,g.modify_DataOperation);h.copy(g.modify_Transform,{transform:function(a,b){var c,e,f,j,k,l;if(0==a.rowCount())return a;l=g.modify_DataOperation.map(b);if(h.isEmpty(l))return a;e=h.Array(a.fields.length,null);for(f=0;f<e.length;f++){k=null;c=h.iter(l);for(j=c.current;c.hasNext();j=c.next())h.equals(j[0],a.fields[f].name)&&
(k=j[1]);e[f]=g.modify_Transform.modify(a.fields[f],k);e[f].set("summary",k)}return a.replaceFields(e)},makeKey:function(a,b){var c,e,f="|";c=h.iter(a);for(e=c.current;c.hasNext();e=c.next())f+=e.value(b)+"|";return f},modify:function(a,b){var c,e;if(null==b)return a;e=b.split(":");c=e[0].trim();e=1<e.length?e[1].trim():null;return"bin"==c?(c=null==e?-1:g.Data.parseInt(e),g.modify_Transform.bin(a,c)):"rank"==c?g.modify_Transform.rank(a,"ascending"==e):a},rank:function(a,b){for(var c,e,f=a.rowCount(),
j=(new g.summary_FieldRowComparison([a],[b],!0)).makeSortedOrder(),k=h.Array(f,null),l=0;l<f;){c=j[l];for(e=l+1;e<f&&0==a.compareRows(c,j[e]);)e++;for(c=l;c<e;c++)k[j[c]]=(l+e+1)/2;l=e}e=g.Fields.makeColumnField(a.name,a.label,k);e.setNumeric();return e},bin:function(a,b){var c=a.preferCategorical()?g.modify_Transform.binCategorical(a,b):g.modify_Transform.binNumeric(a,b);c.set("binned",!0);return c},binCategorical:function(a,b){var c,e,f,j;1>b&&(b=7);c=a.categories();if(c.length<=b)return a;j=g.Data.order(a.property("categoryCounts"),
!1);f=new h.Map;for(e=0;e<j.length;e++)f.put(c[j[e]],e<b-1?c[j[e]]:"…");c=h.Array(a.rowCount(),null);for(e=0;e<c.length;e++)c[e]=f.get(a.value(e));return g.Fields.makeColumnField(a.name,a.label,c)},binNumeric:function(a,b){var c=g.auto_Auto.makeNumericScale(g.auto_NumericExtentDetail.makeForField(a),!0,[0,0],0,b+1,!0),e=c.divisions,f=a.isDate()?a.property("dateFormat"):null,c=g.modify_Transform.makeBinRanges(e,f,c.granular),e=g.modify_Transform.binData(a,e,c),e=g.Fields.makeColumnField(a.name,a.label,
e);a.isDate()&&e.set("date",!0);e.setNumeric();e.set("categories",c);e.set("transform",a.property("transform"));return e},makeBinRanges:function(a,b,c){var e,f,j,k=h.Array(a.length-1,null);for(j=0;j<k.length;j++)e=a[j],f=a[j+1],k[j]=null==b?g.util_Range.makeNumeric(e,f,c):g.util_Range.makeDate(e,f,c,b);return k},binData:function(a,b,c){var e,f,j=h.Array(a.rowCount(),null);for(f=0;f<j.length;f++)e=g.Data.asNumeric(a.value(f)),null!=e&&(e=g.Data.indexOf(e,b),j[f]=c[Math.min(e,c.length-1)]);return j}});
g.modify_ConvertSeries=function(){h.superconstruct(this)};h.extend(g.modify_ConvertSeries,g.modify_DataOperation);h.copy(g.modify_ConvertSeries,{transform:function(a,b){var c,e,f,j,k,l,m,n,q,s;if(h.isEmpty(b))return a;j=g.modify_DataOperation.strings(b,";");q=g.modify_DataOperation.strings(j[0],",");n=q.length;m=a.rowCount();if(2>n)return a;c=g.modify_ConvertSeries.addRequired(g.modify_DataOperation.strings(2>j.length?"":j[1],","));s=h.Array(n,null);for(k=0;k<n;k++)if(s[k]=a.field(q[k]),null==s[k])throw new h.Exception("ConvertSeries Could not find field for name: "+
q[k]);f=h.Array(n*m,0);j=h.Array(n*m,0);e=h.Array(n*m,null);for(k=0;k<n;k++)for(l=0;l<m;l++)f[k*m+l]=k,j[k*m+l]=l,e[k*m+l]=s[k].value(l);m=g.Fields.makeColumnField("#values",g.Data.join(q,null,!1),e);g.Fields.copyBaseProperties(s[0],m);n=g.Fields.makeColumnField("#series","Series",q);f=g.Fields.permute(n,f,!1);f.setCategories(q);q=new h.List;q.add(f);q.add(m);c=h.iter(c);for(f=c.current;c.hasNext();f=c.next())"#series"==f||"#values"==f||(f=a.field(f),q.add(g.Fields.permute(f,j,!1)));j=q.toArray();
return a.replaceFields(j)},addRequired:function(a){var b=new h.List;h.addAll(b,a);b.contains("#row")||b.add("#row");b.contains("#count")||b.add("#count");b.contains("#selection")||b.add("#selection");return b.toArray()}});g.modify_AddConstantFields=function(){h.superconstruct(this)};h.extend(g.modify_AddConstantFields,g.modify_DataOperation);h.copy(g.modify_AddConstantFields,{transform:function(a,b){var c,e,f,j=g.modify_DataOperation.strings(b,";");if(0==j.length)return a;c=h.Array(a.fields.length+
j.length,null);for(e=0;e<j.length;e++)f=j[e],c[e]=g.Data.isQuoted(f)?g.Fields.makeConstantField(f,g.Data.deQuote(f),g.Data.deQuote(f),a.rowCount()):g.Fields.makeConstantField(f,f,g.Data.asNumeric(f),a.rowCount());for(e=0;e<a.fields.length;e++)c[e+j.length]=a.fields[e];return a.replaceFields(c)}});g.modify_Summarize=function(a,b,c,e){h.superconstruct(this);this.measures=a;this.dimensions=b;this.percentBase=c;this.rowCount=e;b=!1;a=h.iter(a);for(c=a.current;a.hasNext();c=a.next())c.isPercent()&&(b=
!0);this.percentNeeded=b};h.extend(g.modify_Summarize,g.modify_DataOperation);h.copy(g.modify_Summarize,{transform:function(a,b){var c,e,f,j,k,l,m,n,q,s;if(0==a.rowCount())return a;c=g.modify_DataOperation.map(b);if(h.isEmpty(c))return a;m=new h.List;l=new h.List;q=new h.List;k=j=f=!1;c=h.iter(c);for(n=c.current;c.hasNext();n=c.next())"#count"==n[0]&&(f=!0),"#row"==n[0]&&(j=!0),"#selection"==n[0]&&(k=!0),s=n[1].split(":"),e=a.field(s[0].trim()),1==s.length?l.add(new g.summary_DimensionField(e,n[0])):
"base"==s[1].trim()?(l.add(new g.summary_DimensionField(e,n[0])),q.add(e)):(e=new g.summary_MeasureField(e,n[0],s[1].trim()),2<s.length&&(e.option=s[2].trim()),m.add(e));h.sort(m);h.sort(l);f||m.add(new g.summary_MeasureField(a.field("#count"),"#count","sum"));j||m.add(new g.summary_MeasureField(a.field("#row"),"#row","list"));k||m.add(new g.summary_MeasureField(a.field("#selection"),"#selection","mode"));f=(new g.modify_Summarize(m,l,q,a.rowCount())).make();f=a.replaceFields(f);f.set("reduced",!0);
f.set("summarized",!0);return f}});h.copy(g.modify_Summarize.prototype,{make:function(){var a,b,c,e,f,j,k,l,m,n;c=this.getFields(this.dimensions);e=this.percentBase.toArray();a=this.getFields(this.measures);b=new g.summary_FieldRowComparison(c,null,!1);f=new g.summary_FieldRowComparison(e,null,!1);k=h.Array(this.rowCount,0);b=this.buildGroups(k,b);j=this.percentNeeded?h.Array(this.rowCount,0):null;l=this.percentNeeded?this.buildGroups(j,f):0;var q=h.Array(b,null);for(f=0;f<q.length;f++)q[f]=new g.summary_SummaryValues(a,
e,c);e=h.Array(l,a.length,0);for(l=0;l<this.rowCount;l++){n=q[k[l]];if(this.percentNeeded){null==n.percentSums&&(n.percentSums=e[j[l]]);for(f=0;f<a.length;f++)this.measures.get(f).isPercent()&&(m=g.Data.asNumeric(a[f].value(l)),null!=m&&(n.percentSums[f]+=m))}n.rows.add(l)}a=h.Array(this.dimensions.size(),b,null);k=h.Array(this.measures.size(),b,null);for(e=0;e<b;e++){l=q[e];j=l.firstRow();for(f=0;f<this.dimensions.size();f++)a[f][e]=c[f].value(j);for(f=0;f<this.measures.size();f++)j=this.measures.get(f),
k[f][e]=l.get(f,j)}c=h.Array(a.length+k.length,null);for(f=0;f<a.length;f++)b=this.dimensions.get(f),c[f]=g.Fields.makeColumnField(b.rename,b.label(),a[f]),g.Fields.copyBaseProperties(b.field,c[f]);for(f=0;f<k.length;f++)j=this.measures.get(f),b=g.Fields.makeColumnField(j.rename,j.label(),k[f]),this.setProperties(j.method,b,j.field),b.set("summary",j.method),b.set("calculated",!0),null!=j.field&&b.set("originalLabel",j.field.label),c[a.length+f]=b;return c},setProperties:function(a,b,c){"list"==a?
(b.copyProperties(c,"dateFormat"),b.set("list",!0)):"count"==a||"percent"==a||"valid"==a||"unique"==a?b.setNumeric():g.Fields.copyBaseProperties(c,b)},getFields:function(a){var b,c=h.Array(a.size(),null);for(b=0;b<c.length;b++)c[b]=a.get(b).field;return c},buildGroups:function(a,b){var c,e,f;if(h.isEmpty(b))return 1;f=b.makeSortedOrder();for(e=c=0;e<a.length;e++)0<e&&0!=b.compare(f[e],f[e-1])&&c++,a[f[e]]=c;return c+1}});g.modify_SetRowCount=function(a,b,c){h.superconstruct(this);this.base=a;this.sizeField=
b;if(!b.isNumeric())throw new h.Exception("Cannot set rows based on a non-numeric field");this.N=c};h.extend(g.modify_SetRowCount,g.modify_DataOperation);h.copy(g.modify_SetRowCount,{transform:function(a,b){var c;if(0==a.rowCount()||h.isEmpty(b))return a;c=g.modify_DataOperation.strings(b,",");return(new g.modify_SetRowCount(a,a.field(c[0]),g.Data.parseInt(c[1]))).make()}});h.copy(g.modify_SetRowCount.prototype,{make:function(){return this.base.rowCount()<this.N?this.addRows():this.base},addRows:function(){var a,
b,c,e,f,j;f=this.base.rowCount();a=h.Array(f,0);e=h.Array(a.length,0);j=0;var k=this.sizeField.numProperty("mean")*this.sizeField.numProperty("n");for(b=0;b<f;b++)c=g.Data.asNumeric(this.sizeField.value(b)),a[b]=null==c?0:c*this.N/k,e[b]=Math.round(a[b]),j+=e[b];for(;j>this.N;){c=0;for(b=1;b<f;b++)a[b]-e[b]<a[c]-e[c]&&(c=b);e[c]--;j--}for(;j<this.N;){c=0;for(b=1;b<f;b++)a[b]-e[b]>a[c]-e[c]&&(c=b);e[c]++;j++}f=h.Array(this.N,0);for(a=j=0;j<this.N;){for(b=0;b<e[a];b++)f[j++]=a;a++}e=h.Array(this.base.fields.length,
null);for(b=0;b<e.length;b++)e[b]=g.Fields.permute(this.base.fields[b],f,!1);return this.base.replaceFields(e)}});g.modify_Filter=function(){h.superconstruct(this)};h.extend(g.modify_Filter,g.modify_DataOperation);h.copy(g.modify_Filter,{transform:function(a,b){var c,e,f,j,k,l,m,n,q,s=g.modify_DataOperation.strings(b,";"),y=s.length;if(0==y)return a;e=h.Array(y,null);q=h.Array(y,0);m=h.Array(y,null);j=h.Array(y,!1);for(f=0;f<y;f++){c=s[f].trim();l=c.indexOf(" ");n=c.indexOf(" ",l+1);0>n&&(n=h.len(c));
e[f]=a.field(c.substring(0,l).trim());l=g.modify_Filter.getType(c.substring(l,n).trim());k=c.indexOf("|| missing");0<k&&(c=c.substring(0,k),j[f]=!0);c=g.modify_Filter.getParams(c.substring(n).trim(),e[f].preferCategorical(),e[f].isDate());if(4==l||-4==l)c=g.modify_Filter.getRankedObjects(e[f],g.Data.asNumeric(c[0]),g.Data.asNumeric(c[1])),l=0>l?-3:3;q[f]=l;m[f]=c}e=g.modify_Filter.makeRowsToKeep(e,q,m,j);return null==e?a:a.retainRows(e)},getRankedObjects:function(a,b,c){var e,f,j=new h.List,k=a.rowCount();
for(e=0;e<k;e++)f=a.value(e),null!=f&&j.add(f);e=j.toArray();g.Data.sort(e);a=e.length;b=Math.min(Math.max(1,Math.floor(b)),a);c=Math.min(Math.max(1,Math.floor(c)),a);return[e[a-c],e[a-b]]},getType:function(a){if(h.startsWith(a,"!"))return-g.modify_Filter.getType(a.substring(1).trim());if("valid"==a)return 1;if("is"==a)return 2;if("in"==a)return 3;if("ranked"==a)return 4;throw new h.Exception("Cannot use filter command "+a);},getParams:function(a,b,c){var e,f=a.split(","),j=h.Array(f.length,null);
for(e=0;e<j.length;e++)a=f[e].trim(),j[e]=b?a:c?g.Data.asDate(g.Data.asNumeric(a)):g.Data.asNumeric(a);return j},makeRowsToKeep:function(a,b,c,e){var f,j,k,l,m,n,q=new h.List,s=a[0].rowCount();for(l=0;l<s;l++){f=!1;for(j=0;j<a.length;j++){n=a[j].value(l);if(null==n){f=!e[j];break}m=b[j];k=c[j];if(2==m||-2==m)f=!g.modify_Filter.matchAny(n,k);else if(3==m||-3==m)f=0>g.Data.compare(n,k[0])||0<g.Data.compare(n,k[1]);0>m&&(f=!f);if(f)break}f||q.add(l)}if(q.size()==s)return null;a=h.Array(q.size(),0);for(j=
0;j<a.length;j++)a[j]=q.get(j);return a},matchAny:function(a,b){var c,e;c=h.iter(b);for(e=c.current;c.hasNext();e=c.next())if(0==g.Data.compare(a,e))return!0;return!1}});g.modify_Stack=function(){h.superconstruct(this)};h.extend(g.modify_Stack,g.modify_DataOperation);h.copy(g.modify_Stack,{transform:function(a,b){var c,e,f,j,k;if(h.isEmpty(b))return a;f=g.modify_DataOperation.strings(b,";");k=f[0];j=g.modify_DataOperation.strings(f[1],",");c=g.modify_DataOperation.strings(f[2],",");f=h.equalsIgnoreCase(f[3],
"true");e=g.modify_Stack.getFields(a.fields,j,c,[k]);e=g.modify_Stack.makeStackOrderedFields(a,e,j.length);f&&(e=(new g.modify_AllCombinations(e,j.length,c.length)).make());c=g.modify_Stack.makeStackedValues(e,g.modify_Stack.getField(e,k),g.modify_Stack.getFields(e,j),f);return a.replaceFields(c)},getField:function(a,b){var c,e;c=h.iter(a);for(e=c.current;c.hasNext();e=c.next())if(h.equals(e.name,b))return e;throw new h.Exception("Could not find field: "+b);},getFields:function(a){var b=Array.prototype.slice.call(arguments,
1),c,e,f=new h.List,j=new h.Set,b=h.iter(b);for(c=b.current;b.hasNext();c=b.next()){c=h.iter(c);for(e=c.current;c.hasNext();e=c.next())e=e.trim(),h.isEmpty(e)||(e=g.modify_Stack.getField(a,e),j.add(e)&&f.add(e))}return f.toArray()},makeStackedValues:function(a,b,c,e){var f,j;f=b.rowCount();var k=h.Array(2,f,null),l=0,m=0,n=new g.summary_FieldRowComparison(c,null,!1);for(c=0;c<f;c++){j=g.Data.asNumeric(b.value(c));if(null==j)if(e)j=0;else continue;0<c&&0!=n.compare(c,c-1)&&(m=l=0);0>j?(k[0][c]=m,m+=
j,k[1][c]=m):(k[0][c]=l,l+=j,k[1][c]=l)}f=a.length;e=h.Array(f+2,null);for(c=0;c<f;c++)e[c]=a[c];e[f]=g.Fields.makeColumnField(b.name+"$lower",b.label,k[0]);e[f+1]=g.Fields.makeColumnField(b.name+"$upper",b.label,k[1]);g.Fields.copyBaseProperties(b,e[f]);g.Fields.copyBaseProperties(b,e[f+1]);h.sort(e);return e},makeStackOrderedFields:function(a,b,c){a=g.modify_Stack.orderFields(a,b);c=g.modify_Stack.makeStackDataOrder(a,b.length,c);var e=h.Array(a.length,null);for(b=0;b<a.length;b++)e[b]=g.Fields.permute(a[b],
g.Data.toPrimitive(c),!0);return e},makeStackDataOrder:function(a,b,c){var e,f,j,k=new h.List,l=a[0].rowCount();for(e=0;e<l;e++){j=!0;for(f=0;f<b;f++)null==a[f].value(e)&&(j=!1);j&&k.add(e)}b=h.Array(b,!1);for(e=0;e<b.length;e++)b[e]=e<c;a=new g.summary_FieldRowComparison(a,b,!0);h.sort(k,a);return k.toArray()},orderFields:function(a,b){var c,e,f,g=h.Array(a.fields.length,null),k=new h.Set;for(c=0;c<b.length;c++)g[c]=b[c],k.add(b[c]);e=b.length;c=h.iter(a.fields);for(f=c.current;c.hasNext();f=c.next())k.contains(f)||
(g[e++]=f);return g}});g.Data=function(){};h.copy(g.Data,{indexOf:function(a,b){for(var c,e=-1,f=b.length;1<f-e;)c=Math.floor((f+e)/2),b[c]<=a?e=c:f=c;return e},join:function(a,b,c){var e,f,j;null==b&&(b=", ");j="";e=!0;a=h.iter(a);for(f=a.current;a.hasNext();f=a.next())e||(j+=b),c?j+=g.Data.format(f,!1):f instanceof Number?(e=f,j+=e):j+=f,e=!1;return j},format:function(a,b){return null==a?"?":"number"==typeof a?g.Data.formatNumeric(a,null,b):""+a},formatNumeric:function(a,b,c){return 0==a||null!=
b&&Math.abs(a)<Math.pow(10,-b)?"0":1E-6>=Math.abs(a)||1E8<=Math.abs(a)?h.formatScientific(a):1E-9>Math.abs((a-Math.round(a))/a)?h.formatInt(Math.round(a),c):h.formatFixed(a,null==b?6:b,c)},asNumeric:function(a){if(null==a)return null;if(a&&a.asNumeric)return a.asNumeric();if(a&&a.getTime)return a.getTime()/864E5;a=Number(a);return!isNaN(a)?a:null},sort:function(a){h.sort(a,g.Data.compare)},compare:function(a,b){return h.compare(a,b)},toDate:function(a,b){var c,e,f,j,k;if(a.isDate())return a;e=h.Array(a.rowCount(),
null);c=!1;for(f=0;f<e.length;f++)j=a.value(f),"year"==b?(k=g.Data.asNumeric(j),null!=k&&0<k&&(e[f]=g.Data.asDate(g.Data.format(k,!1)+"-01-01"))):"excel"==b?(k=g.Data.asNumeric(j),null!=k&&(e[f]=g.Data.asDate(k-24107))):e[f]=g.Data.asDate(j),c||(c=0!=g.Data.compare(j,e[f]));c=g.Fields.makeColumnField(a.name,a.label,e);c.set("date",!0);c.setNumeric();return c},asDate:function(a){return null==a?null:a.getTime?a:"string"==typeof a?(d=h.parseDate(a),null==d||isNaN(d.getTime())?null:d):!isNaN(a)?new Date(864E5*
a):null},toNumeric:function(a){var b,c,e;if(a.isNumeric())return a;b=h.Array(a.rowCount(),0);for(c=0;c<b.length;c++)e=a.value(c),b[c]=g.Data.asNumeric(e);a=g.Fields.makeColumnField(a.name,a.label,b);a.setNumeric();return a},toList:function(a){var b,c,e,f,j,k,l,m,n=",";j=-1;b=h.iter([",",";","|"]);for(l=b.current;b.hasNext();l=b.next()){e=0;c=h.iter(a.categories());for(f=c.current;c.hasNext();f=c.next())0<=f.toString().indexOf(e)&&e++;e>j&&(n=l,j=e)}k=a.rowCount();c=new h.Map;j=h.Array(k,null);for(e=
0;e<k;e++)if(f=a.value(e),null!=f){m=new h.List;b=h.iter(g.Data.split(f.toString(),n));for(l=b.current;b.hasNext();l=b.next())l=l.trim(),0<h.len(l)&&(f=c.get(l),null==f&&(f=l,c.put(f,l)),m.add(f));j[e]=new g.util_ItemsList(m.toArray())}a=g.Fields.makeColumnField(a.name,a.label,j);f=c.values().toArray();h.sort(f);a.set("list",!0);a.set("listCategories",f);return a},split:function(a,b){return a.split(b)},isQuoted:function(a){var b;if(null==a||2>h.len(a))return!1;b=a.charAt(0);return'"'==b||"'"==b&&
a.charAt(h.len(a)-1)==b},parseInt:function(a){return Math.floor(a)},parseDouble:function(a){return+a},deQuote:function(a){var b,c,e="",f=h.len(a)-1;for(c=1;c<f;c++)b=a.charAt(c),"\\"==b?(b=a.charAt(++c),e="n"==b?e+"\n":"t"==b?e+"\t":e+b):e+=b;return e},quote:function(a){var b,c,e,f,j;if(null==a)return"null";f="'";0<=a.indexOf(f)&&(f='"');j="";e=h.len(a);for(c=0;c<e;c++)b=a.charAt(c),j="\n"==b?j+"\\n":"\r"==b?j+" ":"\t"==b?j+"\\t":"\\"==b?j+"\\\\":b==f?j+("\\"+b):"ÿ"<=b?j+("\\u"+g.Data.hex4Format(b)):
j+b;return f+j+f},hex4Format:function(a){return("0000"+a.charCodeAt(0).toString(16)).substr(-4)},order:function(a,b){for(var c=[],e=0;e<a.length;e++)c.push(e);c.sort(function(c,e){var g=h.compare(a[c],a[e]);return b?g:-g});return c},toPrimitive:function(a){return a},replaceExpression:function(a,b,c){return a.replace(RegExp(b,"g"),c)},shorten:function(a,b){var c,e,f,j;a=g.Data.replaceExpression(a.trim(),"[ \t\n]+"," ");if(h.len(a)<=b)return a;if(1>b)return"";a=g.Data.replaceExpression(a," *\\(.*\\) *",
"");if(h.len(a)<=b)return a;c=g.Data.split(a," ");j=g.Data.asList(c);f=g.Data.combinedLength(j);for(c=" ";f>b;){e=g.Data.killBoring(j);if(0==e)break;f-=e}e=new h.List(j);f<3*b&&(f=g.Data.removeVowels(j,f,b));f>b&&(j=e,f=g.Data.combinedLength(j),2<j.size()&&(c="…",f=g.Data.dropWords(j,f,b)));return f>b&&(e=j.get(0),f=g.Data.removeVowels(j,f,b),f>b)?h.len(e)<b?e+"…":e.substring(0,b):g.Data.join(j,c)},dropWords:function(a,b,c){for(var e;2<a.size()&&b>c;)e=a.size()-2,b-=h.len(a.get(e))+1,a.remove(e);
return b},removeVowels:function(a,b,c){var e,f,j;if(b<=c)return b;e=a.size();j=h.Array(e,0);for(f=0;f<e-2;f++)j[f]=e-2-f;1<e&&(j[e-2]=e-1);j[e-1]=0;e=h.iter(j);for(f=e.current;e.hasNext();f=e.next())for(;g.Data.stripVowel(a,f);)if(--b<=c)return b;return b},combinedLength:function(a){var b,c=a.size()-1;a=h.iter(a);for(b=a.current;a.hasNext();b=a.next())c+=h.len(b);return c},asList:function(a){var b,c=new h.List;a=h.iter(a);for(b=a.current;a.hasNext();b=a.next())c.add(b);return c},stripVowel:function(a,
b){var c,e,f=a.get(b);for(e=h.len(f)-2;1<=e;e--)if(c=f.charAt(e),"a"==c||"e"==c||"i"==c||"o"==c||"u"==c)return a.set(b,f.substring(0,e)+f.substring(e+1)),!0;return!1},killBoring:function(a){var b,c;for(b=a.size()-1;0<=b;b--)if(c=a.get(b),h.equalsIgnoreCase(c,"the")||h.equalsIgnoreCase(c,"of"))return a.remove(b),h.len(c)+1;return 0}});g.Fields=function(){};h.copy(g.Fields,{makeConstantField:function(a,b,c,e){a=new g.Field(a,b,new g.values_ConstantProvider(c,e));null!=g.Data.asNumeric(c)&&a.setNumeric();
return a},makeIndexingField:function(a,b,c){a=new g.Field(a,b,new g.values_RowProvider(c));a.setNumeric();return a},makeColumnField:function(a,b,c){return new g.Field(a,b,new g.values_ColumnProvider(c))},permute:function(a,b,c){if(a.provider instanceof g.values_ConstantProvider)return c?a:g.Fields.makeConstantField(a.name,a.label,a.value(0),b.length);if(c)return new g.Field(a.name,a.label,new g.values_ReorderedProvider(a.provider,b),a);b=new g.Field(a.name,a.label,new g.values_ReorderedProvider(a.provider,
b));g.Fields.copyBaseProperties(a,b);return b},copyBaseProperties:function(a,b){b.copyProperties(a,"numeric","binned","summary","transform","list","listCategories","date","categoriesOrdered","dateUnit","dateFormat");a.isProperty("categoriesOrdered")&&b.set("categories",a.property("categories"))}});g.Field=function(a,b,c,e){h.superconstruct(this);this.provider=null;this.calculatedDate=this.calculatedNumeric=this.calculatedNominal=!1;this.categoryOrder=null;this.name=a;this.label=null==b?a:b;this.provider=
c;null!=e&&(null==c&&(e.makeNominalStats(),e.makeNumericStats(),e.makeDateStats()),this.copyAllProperties(e))};g.Field.VAL_SELECTED="✓";g.Field.VAL_UNSELECTED="✗";h.extend(g.Field,g.util_Informative);h.copy(g.Field.prototype,{setValue:function(a,b){this.provider=this.provider.setValue(a,b)},compareRows:function(a,b){null==this.categoryOrder&&(this.categoryOrder=new g.util_MapInt,this.preferCategorical()&&this.categoryOrder.index(this.categories()));return this.provider.compareRows(a,b,this.categoryOrder)},
expectedSize:function(){return 2*(h.len(this.label)+h.len(this.name))+108+this.provider.expectedSize()},property:function(a){var b=g.Field.$super.property.call(this,a);null==b&&(!this.calculatedNominal&&g.stats_NominalStats.creates(a)&&(this.makeNominalStats(),b=g.Field.$super.property.call(this,a)),!this.calculatedNumeric&&g.stats_NumericStats.creates(a)&&(this.calculatedNominal||this.makeNominalStats(),this.makeNumericStats(),b=g.Field.$super.property.call(this,a)),!this.calculatedDate&&g.stats_DateStats.creates(a)&&
(this.isDate()?(this.calculatedNominal||this.makeNominalStats(),this.calculatedNumeric||this.makeNumericStats(),this.makeDateStats(),b=g.Field.$super.property.call(this,a)):this.calculatedDate=!0));return b},setCategories:function(a){this.set("categories",a);this.set("categoriesOrdered",!0)},makeDateStats:function(){this.isNumeric()&&g.stats_DateStats.populate(this);this.calculatedDate=!0},isNumeric:function(){return this.isProperty("numeric")},setNumeric:function(){this.set("numeric",!0)},isDate:function(){return this.isProperty("date")},
isBinned:function(){return this.isProperty("binned")},makeNumericStats:function(){null!=this.provider&&g.stats_NumericStats.populate(this);this.calculatedNumeric=!0},makeNominalStats:function(){null!=this.provider&&g.stats_NominalStats.populate(this);this.calculatedNominal=!0},categories:function(){return this.property("categories")},compareTo:function(a){var b=g.Data.compare(this.name,a.name);return h.startsWith(this.name,"#")?h.startsWith(a.name,"#")?b:1:h.startsWith(a.name,"#")?-1:b},dropData:function(){return new g.Field(this.name,
this.label,null,this)},max:function(){return this.property("max")},min:function(){return this.property("min")},isSynthetic:function(){return h.startsWith(this.name,"#")},isConstant:function(){return h.startsWith(this.name,"'")},preferCategorical:function(){return!this.isNumeric()||this.isBinned()},ordered:function(){return this.isNumeric()||"#selection"==this.name},rename:function(a,b){var c=new g.Field(a,b,this.provider);c.copyAllProperties(this);return c},rowCount:function(){return null!=this.provider?
this.provider.count():this.numProperty("n")},toString:function(){return this.name},uniqueValuesCount:function(){return Math.round(this.numProperty("unique"))},valid:function(){return this.property("valid")},value:function(a){return null==a?null:this.provider.value(a)},valueFormatted:function(a){return this.format(this.value(a))},format:function(a){return null==a?null:a instanceof g.util_Range?a.toString():this.isDate()?this.property("dateFormat").format(g.Data.asDate(a)):"percent"==this.property("summary")?
(a=g.Data.asNumeric(a),null==a?null:g.Data.formatNumeric(Math.round(10*a)/10,null,!1)+"%"):this.isNumeric()?(a=g.Data.asNumeric(a),a=null==a?"?":g.Data.formatNumeric(a,this.numProperty("decimalPlaces"),!0),"percent"==this.property("summary")?a+"%":a):this.isProperty("list")?a.format(!0,this.property("dateFormat")):a.toString()}});g.stats_NumericStats=function(){};h.copy(g.stats_NumericStats,{populate:function(a){var b,c,e,f,j,k,l,m;b=a.rowCount();e=new h.List;for(k=0;k<b;k++)j=a.value(k),null!=j&&
(j instanceof g.util_Range?(l=j.low,j=j.high,e.add(g.Data.asNumeric(l)),e.add(g.Data.asNumeric(j))):(c=g.Data.asNumeric(j),null!=c&&e.add(c)));e=e.toArray();b=e.length;a.set("validNumeric",b);if(0!=b){k=g.stats_NumericStats.moment(e,0,1,b);l=g.stats_NumericStats.moment(e,k,2,b-1);j=g.stats_NumericStats.moment(e,k,3,b-1);c=g.stats_NumericStats.moment(e,k,4,b-1);a.set("mean",k);a.set("stddev",Math.sqrt(l));a.set("variance",l);a.set("skew",j/l/Math.sqrt(l));a.set("kurtosis",c/l/l-3);h.sort(e);j=e[0];
l=e[b-1];a.set("min",j);a.set("max",l);a.set("median",g.stats_NumericStats.av(e,0.5*(b-1)));0==b%2?(a.set("q1",g.stats_NumericStats.av(e,0.5*(b/2-1))),a.set("q3",g.stats_NumericStats.av(e,b/2+0.5*(b/2-1)))):(a.set("q1",g.stats_NumericStats.av(e,0.25*(b-1))),a.set("q3",g.stats_NumericStats.av(e,(b-1)/2+0.25*(b-1))));m=l-j;b=!0;0==m&&(m=Math.abs(l));for(k=1;k<e.length;k++)c=e[k]-e[k-1],0<c&&(m=Math.min(m,c)),b&&e[k]!=Math.round(e[k])&&(b=!1);a.set("minDelta",m);f=m;for(k=1;k<e.length;k++)if(c=e[k]-
e[k-1],c%=f,0<c)if(0==f%c)f=c;else{f=0;break}a.set("minDelta",m);a.set("granularity",f);e=l==j?0==l?1:Math.abs(l):l-j;e=Math.max(0,Math.round(4-Math.log(e)/Math.log(10)));a.set("decimalPlaces",b&&5<l-j?0:e)}},moment:function(a,b,c,e){var f,g;if(0>=e)return Number.NaN;g=0;a=h.iter(a);for(f=a.current;a.hasNext();f=a.next())g+=Math.pow(f-b,c);return g/e},av:function(a,b){return(a[Math.floor(b)]+a[Math.ceil(b)])/2},creates:function(a){return"validNumeric"==a||"mean"==a||"stddev"==a||"variance"==a||"skew"==
a||"kurtosis"==a||"min"==a||"max"==a||"q1"==a||"q3"==a||"median"==a||"granularity"==a||"decimalPlaces"==a}});g.stats_NominalStats=function(){};h.copy(g.stats_NominalStats,{populate:function(a){var b,c=new g.util_MapInt,e=a.rowCount();for(b=0;b<e;b++)c.increment(a.value(b));a.set("n",e);a.set("unique",c.size());a.set("valid",c.getTotalCount());a.set("mode",c.mode());a.isProperty("categoriesOrdered")?b=a.categories():(b="#selection"==a.name?[g.Field.VAL_UNSELECTED,g.Field.VAL_SELECTED]:c.sortedKeys(),
a.set("categories",b));a.set("categoryCounts",c.getCounts(b))},creates:function(a){return"n"==a||"mode"==a||"unique"==a||"valid"==a||"categories"==a||"categoryCounts"==a}});g.stats_DateStats=function(){};h.copy(g.stats_DateStats,{populate:function(a){var b,c,e;null!=a.min()&&(b=a.max()-a.min(),0==b&&(b=a.max()),e=g.stats_DateStats.getUnit(b),a.set("dateUnit",e),c=a.numProperty("minDelta"),b=Math.min(1,Math.sqrt(a.valid())/7),a.set("dateFormat",g.stats_DateStats.getFormat(e,c*b)))},getUnit:function(a){var b,
c;b=h.iter(g.util_DateUnit.values());for(c=b.current;b.hasNext();c=b.next())if(a>3.5*c.approxDaysPerUnit||c==g.util_DateUnit.day&&a>=2.5*c.approxDaysPerUnit)return c;return g.util_DateUnit.second},getFormat:function(a,b){return 360<b?g.util_DateFormat.Year:13<b?g.util_DateFormat.YearMonth:0.9<b?g.util_DateFormat.YearMonthDay:a.ordinal()<g.util_DateUnit.hour.ordinal()?g.util_DateFormat.DayHour:6.25E-4<b?g.util_DateFormat.HourMin:g.util_DateFormat.HourMinSec},creates:function(a){return"dateUnit"==a||
"dateFormat"==a}});g.summary_DimensionField=function(a,b){this.field=a;this.rename=null==b?a.name:b};h.copy(g.summary_DimensionField.prototype,{compareTo:function(a){return g.Data.compare(this.rename,a.rename)},getDateFormat:function(){return this.isDate()?this.field.property("dateFormat"):null},isDate:function(){return null!=this.field&&this.field.isDate()},label:function(){return null==this.field?this.rename:this.field.label}});g.summary_MeasureField=function(a,b,c){this.option=null;this.fits=new h.Map;
h.superconstruct(this,a,null==b&&null==a?c:b);this.method=null!=a&&"mean"==c&&!a.isNumeric()?"mode":c};h.extend(g.summary_MeasureField,g.summary_DimensionField);h.copy(g.summary_MeasureField.prototype,{getFit:function(a,b){return this.fits.get(g.modify_Transform.makeKey(a,b))},setFit:function(a,b,c){this.fits.put(g.modify_Transform.makeKey(a,b),c)},isPercent:function(){return"percent"==this.method},label:function(){var a,b;if("list"==this.method)return this.field.label;if("count"==this.method)return"Count";
if(null==this.field||"#count"==this.field.name){if("sum"==this.method)return this.field.label;if("percent"==this.method)return"Percent"}a=this.method.substring(0,1).toUpperCase();b=this.method.substring(1);return a+b+"("+this.field.label+")"}});g.summary_Fit=function(a,b,c){var e,f,j,k;this.fx=b;this.fy=a;this.xCatMap=this.makeCatMap(b);this.yCatMap=this.makeCatMap(a);f=new h.List;k=new h.List;e=h.iter(c);for(c=e.current;e.hasNext();c=e.next())j=this.vx(b.value(c)),c=this.vy(a.value(c)),null!=j&&
null!=c&&(f.add(j),k.add(c));a=f.size();b=g.Data.order(f.toArray(),!0);this.x=h.Array(a,0);this.y=h.Array(a,0);for(c=0;c<a;c++)this.x[c]=f.get(b[c]),this.y[c]=k.get(b[c]);this.my=g.summary_Fit.mean(this.y);this.mx=g.summary_Fit.mean(this.x)};h.copy(g.summary_Fit,{mean:function(a){var b,c,e=0;b=h.iter(a);for(c=b.current;b.hasNext();c=b.next())e+=c;return e/a.length}});h.copy(g.summary_Fit.prototype,{makeCatMap:function(a){var b,c;if(a.isNumeric())return null;c=new h.Map;a=a.categories();for(b=0;b<
a.length;b++)c.put(a[b],b);return c},vx:function(a){return null==this.xCatMap?g.Data.asNumeric(a):this.xCatMap.get(a)},vy:function(a){return null==this.yCatMap?g.Data.asNumeric(a):this.yCatMap.get(a)},reverseY:function(a){var b;if(null==this.yCatMap)return a;b=Math.round(a);a=this.fy.categories();return 0>b||b>=a.length?null:a[b]}});g.summary_SummaryValues=function(a,b,c){var e,f,g;this.rows=new h.List;this.percentSums=null;this.fields=a;this.xFields=b;this.groupFields=new h.List;a=h.iter(c);for(e=
a.current;a.hasNext();e=a.next()){f=!0;c=h.iter(b);for(g=c.current;c.hasNext();g=c.next())g==e&&(f=!1);f&&this.groupFields.add(e)}};h.copy(g.summary_SummaryValues.prototype,{firstRow:function(){return this.rows.get(0)},get:function(a,b){var c,e,f,j,k;c=b.method;if("count"==c)return this.rows.size();f=0==this.xFields.length?null:this.xFields[this.xFields.length-1];e=this.rows.get(0);if("fit"==c)return c=b.getFit(this.groupFields,e),null==c&&(c=new g.summary_Regression(b.field,f,this.validForGroup(e))),
b.setFit(this.groupFields,e,c),c.get(f.value(e));if("smooth"==c)return c=b.getFit(this.groupFields,e),null==c&&(c=null,null!=b.option&&(c=g.Data.parseDouble(b.option)),c=new g.summary_Smooth(b.field,f,c,this.validForGroup(e))),b.setFit(this.groupFields,e,c),c.get(f.value(this.rows.get(0)));e=h.Array(this.rows.size(),null);for(f=0;f<e.length;f++)e[f]=this.fields[a].value(this.rows.get(f));e=g.Fields.makeColumnField("temp",null,e);f=e.numProperty("mean");if("percent"==c){if(null==f)return null;c="overall"==
b.option?b.field.valid()*b.field.numProperty("mean"):this.percentSums[a];return 0<c?100*f*e.valid()/c:null}return"range"==c?this.makeRange(b,e,"min","max"):"iqr"==c?this.makeRange(b,e,"q1","q3"):"stderr"==c&&(k=e.numProperty("stddev"),j=1,null!=b.option&&(j=g.Data.parseDouble(b.option)),null!=k&&null!=f)?g.util_Range.make(f-k*j,f+k*j,b.getDateFormat()):"sum"==c?null==f?null:f*e.numProperty("valid"):"list"==c?(c=new g.util_ItemsList(e.property("categories")),null!=b.option&&(e=g.Data.parseInt(b.option),
c.setDisplayCount(e)),c):e.property(c)},makeRange:function(a,b,c,e){return g.util_Range.make(b.numProperty(c),b.numProperty(e),a.getDateFormat())},validForGroup:function(a){var b,c,e,f,g=new h.List,k=this.fields[0].rowCount();for(e=0;e<k;e++){f=!0;b=h.iter(this.groupFields);for(c=b.current;b.hasNext();c=b.next())0!=c.compareRows(a,e)&&(f=!1);f&&g.add(e)}return g}});g.summary_FieldRowComparison=function(a,b,c){this.fields=a;this.ascending=b;this.rowsBreakTies=c;this.n=null==b?a.length:b.length};h.copy(g.summary_FieldRowComparison.prototype,
{compare:function(a,b){var c,e;for(c=0;c<this.n;c++)if(e=this.fields[c].compareRows(a,b),0!=e)return null!=this.ascending&&!this.ascending[c]?-e:e;return this.rowsBreakTies?a-b:0},isEmpty:function(){return 0==this.fields.length},makeSortedOrder:function(){var a,b=this.fields[0].rowCount(),c=h.Array(b,0);for(a=0;a<b;a++)c[a]=a;h.sort(c,this);return g.Data.toPrimitive(c)}});g.summary_Smooth=function(a,b,c,e){h.superconstruct(this,a,b,e);this.window=this.getWindowWidth(b,c)};h.extend(g.summary_Smooth,
g.summary_Fit);h.copy(g.summary_Smooth.prototype,{getWindowWidth:function(a,b){var c,e,f;a.isNumeric()?(e=a.min(),f=a.max()):(e=0,f=a.categories().length-1);if(null!=b)return(f-e)*b/200;c=g.auto_Auto.optimalBinCount(a);return(f-e)/c},get:function(a){a=this.vx(a);return null==a?null:this.reverseY(this.calc(a,this.window))},calc:function(a,b){var c,e;e=this.search(a-b,this.x);for(var f=this.search(a+b,this.x),g=0,h=0;e<=f;e++)c=(this.x[e]-a)/b,c=0.75*(1-c*c),1E-5<c&&(h+=c,g+=c*this.y[e]);return 1E-4>
h?b<10*this.window?this.calc(a,2*b):this.my:g/h},search:function(a,b){for(var c,e=0,f=b.length-1;1<f-e;)c=e+f>>1,b[c]<=a&&(e=c),b[c]>=a&&(f=c);for(;0<e&&b[e-1]==a;)e--;for(;f<b.length-1&&b[f+1]==a;)f++;return e+f>>1}});g.summary_Regression=function(a,b,c){var e;h.superconstruct(this,a,b,c);b=this.x.length;for(a=c=e=0;a<b;a++)e+=(this.x[a]-this.mx)*(this.y[a]-this.my),c+=(this.x[a]-this.mx)*(this.x[a]-this.mx);this.m=0==c?0:e/c;this.b=this.my-this.m*this.mx};h.extend(g.summary_Regression,g.summary_Fit);
h.copy(g.summary_Regression.prototype,{get:function(a){return null==this.m||null==a?null:this.reverseY(this.m*this.vx(a)+this.b)}});return g}();
