(function(){if(!window.PowerPack){PowerPack={}}PowerPack.Admin={};PowerPack.Admin.AutoAddLicensedUsersView=Backbone.View.extend({events:{"change .powerpack-auto-add-mode input[type=radio]":"_updateState"},render:function(){this._$modes=this.$(".powerpack-auto-add-mode input[type=radio]");this._$groupFields=this.$(".powerpack-auto-add-groups").find("select, input");this._updateState();return this},_updateState:function(){var $checked=this._$modes.filter(":checked");this._$groupFields.prop("disabled",$checked.val()!=="groups")}});PowerPack.Admin.ImportLicensedUsersView=Backbone.View.extend({events:{"change #id_source input[type=radio]":"_updateState"},render:function(){this._$radios=this.$("#id_source input[type=radio]");this._$groups=this.$("#id_group");this._$importButton=this.$("#powerpack_import_users");this._updateState();return this},_updateState:function(){var $checked=this._$radios.filter(":checked");this._$importButton.prop("disabled",$checked.length===0);this._$groups.prop("disabled",$checked.val()!=="group")}});PowerPack.Admin.ManageLicensedUsersView=Backbone.View.extend({events:{"change #powerpack_users input[type=checkbox]":"_onCheckboxesChanged","click #powerpack_users input[type=checkbox]":"_onCheckboxesClicked"},initialize:function(){this._$checkboxes=null;this._$removeButton=null;this._lastChecked=null},render:function(){this._$checkboxes=this.$("#powerpack_users input[type=checkbox]");this._$removeButton=this.$("#powerpack_remove_users");this.$("#id_users").rbautocomplete({url:SITE_ROOT+"api/users/",matchCase:false,multiple:true,width:350,extraParams:{fullname:1},parse:function(data){var items=data.users,parsed=[],value,i;for(i=0;i<items.length;i++){value=items[i];parsed.push({data:value,value:value.username,result:value.username})}return parsed},formatItem:function(data){var s=data.username;if(data.fullname){s+=" <span>("+_.escape(data.fullname)+")</span>"}return s},cmp:function(term,a,b){var aUsername=a.data.username,bUsername=b.data.username,aFullname=a.data.fullname,bFullname=a.data.fullname;if(aUsername.indexOf(term)===0){if(bUsername.indexOf(term)===0){return aUsername.localeCompare(bUsername)}return-1}else if(bUsername.indexOf(term)===0){return 1}else{return aFullname.localeCompare(bFullname)}},error:function(xhr){var text;try{text=$.parseJSON(xhr.responseText).err.msg}catch(e){text="HTTP "+xhr.status+" "+xhr.statusText}alert(text)}}).on("autocompleteshow",function(){var $resultsPane=$(".ui-autocomplete-results:not("+":has(.ui-autocomplete-footer))");if($resultsPane.length>0){$("<div/>").addClass("ui-autocomplete-footer").text(gettext("Press Tab to auto-complete.")).appendTo($resultsPane)}});return this},_onCheckboxesChanged:function(){var checkedCount=this._$checkboxes.filter(":checked").length;this._$removeButton.prop("disabled",checkedCount===0)},_onCheckboxesClicked:function(evt){var $rangedCheckboxes,start,end;if(this._lastChecked&&evt.shiftKey){start=this._$checkboxes.index(evt.target);end=this._$checkboxes.index(this._lastChecked);$rangedCheckboxes=this._$checkboxes.slice(Math.min(start,end),Math.max(start,end)+1);$rangedCheckboxes.prop("checked",this._lastChecked.checked)}this._lastChecked=evt.target}})}).call(this);